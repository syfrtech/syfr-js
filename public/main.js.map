{"version":3,"file":"main.js","mappings":"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","sources":["webpack://Syfr/./node_modules/jose/dist/browser/lib/buffer_utils.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/base64url.js","webpack://Syfr/./node_modules/jose/dist/browser/util/errors.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/webcrypto.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/random.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/iv.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/check_cek_length.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/is_key_like.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/zlib.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/bogus.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/crypto_key.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/invalid_key_input.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/aeskw.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/digest.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/subtle_rsaes.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/cek.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/env.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/jwk_to_key.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/encrypt.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/check_iv_length.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/encrypt_key_management.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/check_key_type.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/ecdhes.js","webpack://Syfr/./node_modules/jose/dist/browser/key/export.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/key_to_jwk.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/rsaes.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/check_key_length.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/pbes2kw.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/check_p2s.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/aesgcmkw.js","webpack://Syfr/./node_modules/jose/dist/browser/jwe/flattened/encrypt.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/is_disjoint.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/validate_crit.js","webpack://Syfr/./node_modules/jose/dist/browser/jwe/compact/encrypt.js","webpack://Syfr/./src/encrypt.ts","webpack://Syfr/./src/event.ts","webpack://Syfr/./src/class.ts","webpack://Syfr/./src/request.ts","webpack://Syfr/./node_modules/jose/dist/browser/key/import.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/is_object.js","webpack://Syfr/./src/react.ts","webpack://Syfr/webpack/bootstrap","webpack://Syfr/webpack/runtime/define property getters","webpack://Syfr/webpack/runtime/hasOwnProperty shorthand","webpack://Syfr/webpack/runtime/make namespace object"],"sourcesContent":["export const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    buffers.forEach((buffer) => {\n        buf.set(buffer, i);\n        i += buffer.length;\n    });\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(digest, secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    let res;\n    for (let iter = 1; iter <= iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        if (!res) {\n            res = await digest('sha256', buf);\n        }\n        else {\n            res = concat(res, await digest('sha256', buf));\n        }\n    }\n    res = res.slice(0, bits >> 3);\n    return res;\n}\n","import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    return new Uint8Array(atob(encoded)\n        .split('')\n        .map((c) => c.charCodeAt(0)));\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch (_a) {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n","export class JOSEError extends Error {\n    constructor(message) {\n        var _a;\n        super(message);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        (_a = Error.captureStackTrace) === null || _a === void 0 ? void 0 : _a.call(Error, this, this.constructor);\n    }\n    static get code() {\n        return 'ERR_JOSE_GENERIC';\n    }\n}\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, claim = 'unspecified', reason = 'unspecified') {\n        super(message);\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n    }\n    static get code() {\n        return 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    }\n}\nexport class JWTExpired extends JOSEError {\n    constructor(message, claim = 'unspecified', reason = 'unspecified') {\n        super(message);\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n    }\n    static get code() {\n        return 'ERR_JWT_EXPIRED';\n    }\n}\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n    static get code() {\n        return 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n    static get code() {\n        return 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n        this.message = 'decryption operation failed';\n    }\n    static get code() {\n        return 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWE_INVALID';\n    }\n}\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWS_INVALID';\n    }\n}\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWT_INVALID';\n    }\n}\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWK_INVALID';\n    }\n}\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWKS_INVALID';\n    }\n}\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n        this.message = 'no applicable key found in the JSON Web Key Set';\n    }\n    static get code() {\n        return 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n        this.message = 'multiple matching keys found in the JSON Web Key Set';\n    }\n    static get code() {\n        return 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nexport class JWKSTimeout extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_TIMEOUT';\n        this.message = 'request timed out';\n    }\n    static get code() {\n        return 'ERR_JWKS_TIMEOUT';\n    }\n}\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n        this.message = 'signature verification failed';\n    }\n    static get code() {\n        return 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\n","export default crypto;\nexport function isCryptoKey(key) {\n    try {\n        return (key != null &&\n            typeof key.extractable === 'boolean' &&\n            typeof key.algorithm.name === 'string' &&\n            typeof key.type === 'string');\n    }\n    catch (_a) {\n        return false;\n    }\n}\n","import crypto from './webcrypto.js';\nexport default crypto.getRandomValues.bind(crypto);\n","import { JOSENotSupported } from '../util/errors.js';\nimport random from '../runtime/random.js';\nexport function bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A128GCMKW':\n        case 'A192GCM':\n        case 'A192GCMKW':\n        case 'A256GCM':\n        case 'A256GCMKW':\n            return 96;\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            return 128;\n        default:\n            throw new JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexport default (alg) => random(new Uint8Array(bitLength(alg) >> 3));\n","import { JWEInvalid } from '../util/errors.js';\nconst checkCekLength = (cek, expected) => {\n    if (cek.length << 3 !== expected) {\n        throw new JWEInvalid('Invalid Content Encryption Key length');\n    }\n};\nexport default checkCekLength;\n","import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    return isCryptoKey(key);\n};\nexport const types = ['CryptoKey'];\n","import { JOSENotSupported } from '../util/errors.js';\nexport const inflate = async () => {\n    throw new JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.');\n};\nexport const deflate = async () => {\n    throw new JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.');\n};\n","const bogusWebCrypto = [\n    { hash: 'SHA-256', name: 'HMAC' },\n    true,\n    ['sign'],\n];\nexport default bogusWebCrypto;\n","import { isCloudflareWorkers, isNodeJs } from '../runtime/env.js';\nfunction unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.substr(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.substr(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.substr(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.substr(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case isNodeJs() && 'EdDSA': {\n            if (key.algorithm.name !== 'NODE-ED25519' && key.algorithm.name !== 'NODE-ED448')\n                throw unusable('NODE-ED25519 or NODE-ED448');\n            break;\n        }\n        case isCloudflareWorkers() && 'EdDSA': {\n            if (!isAlgorithm(key.algorithm, 'NODE-ED25519'))\n                throw unusable('NODE-ED25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.substr(1, 3), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.substr(1, 3), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH-ES':\n            if (!isAlgorithm(key.algorithm, 'ECDH'))\n                throw unusable('ECDH');\n            break;\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.substr(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n","export default (actual, ...types) => {\n    let msg = 'Key must be ';\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor && actual.constructor.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n};\n","import bogusWebCrypto from './bogus.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nfunction checkKeySize(key, alg) {\n    if (key.algorithm.length !== parseInt(alg.substr(1, 3), 10)) {\n        throw new TypeError(`Invalid key size for alg: ${alg}`);\n    }\n}\nfunction getCryptoKey(key, alg, usage) {\n    if (isCryptoKey(key)) {\n        checkEncCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        return crypto.subtle.importKey('raw', key, 'AES-KW', true, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n}\nexport const wrap = async (alg, key, cek) => {\n    const cryptoKey = await getCryptoKey(key, alg, 'wrapKey');\n    checkKeySize(cryptoKey, alg);\n    const cryptoKeyCek = await crypto.subtle.importKey('raw', cek, ...bogusWebCrypto);\n    return new Uint8Array(await crypto.subtle.wrapKey('raw', cryptoKeyCek, cryptoKey, 'AES-KW'));\n};\nexport const unwrap = async (alg, key, encryptedKey) => {\n    const cryptoKey = await getCryptoKey(key, alg, 'unwrapKey');\n    checkKeySize(cryptoKey, alg);\n    const cryptoKeyCek = await crypto.subtle.unwrapKey('raw', encryptedKey, cryptoKey, 'AES-KW', ...bogusWebCrypto);\n    return new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKeyCek));\n};\n","import crypto from './webcrypto.js';\nconst digest = async (algorithm, data) => {\n    const subtleDigest = `SHA-${algorithm.substr(-3)}`;\n    return new Uint8Array(await crypto.subtle.digest(subtleDigest, data));\n};\nexport default digest;\n","import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleRsaEs(alg) {\n    switch (alg) {\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            return 'RSA-OAEP';\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n","import { JOSENotSupported } from '../util/errors.js';\nimport random from '../runtime/random.js';\nexport function bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n            return 128;\n        case 'A192GCM':\n            return 192;\n        case 'A256GCM':\n        case 'A128CBC-HS256':\n            return 256;\n        case 'A192CBC-HS384':\n            return 384;\n        case 'A256CBC-HS512':\n            return 512;\n        default:\n            throw new JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexport default (alg) => random(new Uint8Array(bitLength(alg) >> 3));\n","export function isCloudflareWorkers() {\n    return typeof WebSocketPair === 'function';\n}\nexport function isNodeJs() {\n    try {\n        return process.versions.node !== undefined;\n    }\n    catch (_a) {\n        return false;\n    }\n}\n","import { isCloudflareWorkers, isNodeJs } from './env.js';\nimport crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { decode as base64url } from './base64url.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'oct': {\n            switch (jwk.alg) {\n                case 'HS256':\n                case 'HS384':\n                case 'HS512':\n                    algorithm = { name: 'HMAC', hash: `SHA-${jwk.alg.substr(-3)}` };\n                    keyUsages = ['sign', 'verify'];\n                    break;\n                case 'A128CBC-HS256':\n                case 'A192CBC-HS384':\n                case 'A256CBC-HS512':\n                    throw new JOSENotSupported(`${jwk.alg} keys cannot be imported as CryptoKey instances`);\n                case 'A128GCM':\n                case 'A192GCM':\n                case 'A256GCM':\n                case 'A128GCMKW':\n                case 'A192GCMKW':\n                case 'A256GCMKW':\n                    algorithm = { name: 'AES-GCM' };\n                    keyUsages = ['encrypt', 'decrypt'];\n                    break;\n                case 'A128KW':\n                case 'A192KW':\n                case 'A256KW':\n                    algorithm = { name: 'AES-KW' };\n                    keyUsages = ['wrapKey', 'unwrapKey'];\n                    break;\n                case 'PBES2-HS256+A128KW':\n                case 'PBES2-HS384+A192KW':\n                case 'PBES2-HS512+A256KW':\n                    algorithm = { name: 'PBKDF2' };\n                    keyUsages = ['deriveBits'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.substr(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.substr(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.substr(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case (isCloudflareWorkers() || isNodeJs()) && 'OKP':\n            if (jwk.alg !== 'EdDSA') {\n                throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            switch (jwk.crv) {\n                case 'Ed25519':\n                    algorithm = { name: 'NODE-ED25519', namedCurve: 'NODE-ED25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case isNodeJs() && 'Ed448':\n                    algorithm = { name: 'NODE-ED448', namedCurve: 'NODE-ED448' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"crv\" (Subtype of Key Pair) Parameter value');\n            }\n            break;\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    var _a, _b;\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        (_a = jwk.ext) !== null && _a !== void 0 ? _a : false,\n        (_b = jwk.key_ops) !== null && _b !== void 0 ? _b : keyUsages,\n    ];\n    if (algorithm.name === 'PBKDF2') {\n        return crypto.subtle.importKey('raw', base64url(jwk.k), ...rest);\n    }\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n","import { concat, uint64be } from '../lib/buffer_utils.js';\nimport checkIvLength from '../lib/check_iv_length.js';\nimport checkCekLength from './check_cek_length.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { types } from './is_key_like.js';\nasync function cbcEncrypt(enc, plaintext, cek, iv, aad) {\n    if (!(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, 'Uint8Array'));\n    }\n    const keySize = parseInt(enc.substr(1, 3), 10);\n    const encKey = await crypto.subtle.importKey('raw', cek.subarray(keySize >> 3), 'AES-CBC', false, ['encrypt']);\n    const macKey = await crypto.subtle.importKey('raw', cek.subarray(0, keySize >> 3), {\n        hash: `SHA-${keySize << 1}`,\n        name: 'HMAC',\n    }, false, ['sign']);\n    const ciphertext = new Uint8Array(await crypto.subtle.encrypt({\n        iv,\n        name: 'AES-CBC',\n    }, encKey, plaintext));\n    const macData = concat(aad, iv, ciphertext, uint64be(aad.length << 3));\n    const tag = new Uint8Array((await crypto.subtle.sign('HMAC', macKey, macData)).slice(0, keySize >> 3));\n    return { ciphertext, tag };\n}\nasync function gcmEncrypt(enc, plaintext, cek, iv, aad) {\n    let encKey;\n    if (cek instanceof Uint8Array) {\n        encKey = await crypto.subtle.importKey('raw', cek, 'AES-GCM', false, ['encrypt']);\n    }\n    else {\n        checkEncCryptoKey(cek, enc, 'encrypt');\n        encKey = cek;\n    }\n    const encrypted = new Uint8Array(await crypto.subtle.encrypt({\n        additionalData: aad,\n        iv,\n        name: 'AES-GCM',\n        tagLength: 128,\n    }, encKey, plaintext));\n    const tag = encrypted.slice(-16);\n    const ciphertext = encrypted.slice(0, -16);\n    return { ciphertext, tag };\n}\nconst encrypt = async (enc, plaintext, cek, iv, aad) => {\n    if (!isCryptoKey(cek) && !(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, ...types, 'Uint8Array'));\n    }\n    checkIvLength(enc, iv);\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            if (cek instanceof Uint8Array)\n                checkCekLength(cek, parseInt(enc.substr(-3), 10));\n            return cbcEncrypt(enc, plaintext, cek, iv, aad);\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            if (cek instanceof Uint8Array)\n                checkCekLength(cek, parseInt(enc.substr(1, 3), 10));\n            return gcmEncrypt(enc, plaintext, cek, iv, aad);\n        default:\n            throw new JOSENotSupported('Unsupported JWE Content Encryption Algorithm');\n    }\n};\nexport default encrypt;\n","import { JWEInvalid } from '../util/errors.js';\nimport { bitLength } from './iv.js';\nconst checkIvLength = (enc, iv) => {\n    if (iv.length << 3 !== bitLength(enc)) {\n        throw new JWEInvalid('Invalid Initialization Vector length');\n    }\n};\nexport default checkIvLength;\n","import { wrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { encrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { encrypt as rsaEs } from '../runtime/rsaes.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nimport generateCek, { bitLength as cekLength } from '../lib/cek.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { exportJWK } from '../key/export.js';\nimport checkKeyType from './check_key_type.js';\nimport { wrap as aesGcmKw } from './aesgcmkw.js';\nasync function encryptKeyManagement(alg, enc, key, providedCek, providedParameters = {}) {\n    let encryptedKey;\n    let parameters;\n    let cek;\n    checkKeyType(alg, key, 'encrypt');\n    switch (alg) {\n        case 'dir': {\n            cek = key;\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!ECDH.ecdhAllowed(key)) {\n                throw new JOSENotSupported('ECDH-ES with the provided key is not allowed or not supported by your javascript runtime');\n            }\n            const { apu, apv } = providedParameters;\n            let { epk: ephemeralKey } = providedParameters;\n            ephemeralKey || (ephemeralKey = await ECDH.generateEpk(key));\n            const { x, y, crv, kty } = await exportJWK(ephemeralKey);\n            const sharedSecret = await ECDH.deriveKey(key, ephemeralKey, alg === 'ECDH-ES' ? enc : alg, alg === 'ECDH-ES' ? cekLength(enc) : parseInt(alg.substr(-5, 3), 10), apu, apv);\n            parameters = { epk: { x, y, crv, kty } };\n            if (apu)\n                parameters.apu = base64url(apu);\n            if (apv)\n                parameters.apv = base64url(apv);\n            if (alg === 'ECDH-ES') {\n                cek = sharedSecret;\n                break;\n            }\n            cek = providedCek || generateCek(enc);\n            const kwAlg = alg.substr(-6);\n            encryptedKey = await aesKw(kwAlg, sharedSecret, cek);\n            break;\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            cek = providedCek || generateCek(enc);\n            encryptedKey = await rsaEs(alg, key, cek);\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            cek = providedCek || generateCek(enc);\n            const { p2c, p2s } = providedParameters;\n            ({ encryptedKey, ...parameters } = await pbes2Kw(alg, key, cek, p2c, p2s));\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            cek = providedCek || generateCek(enc);\n            encryptedKey = await aesKw(alg, key, cek);\n            break;\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            cek = providedCek || generateCek(enc);\n            const { iv } = providedParameters;\n            ({ encryptedKey, ...parameters } = await aesGcmKw(alg, key, cek, iv));\n            break;\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n    return { cek, encryptedKey, parameters };\n}\nexport default encryptKeyManagement;\n","import invalidKeyInput from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nconst symmetricTypeCheck = (key) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${types.join(' or ')} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (key, usage) => {\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nconst checkKeyType = (alg, key, usage) => {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(key);\n    }\n    else {\n        asymmetricTypeCheck(key, usage);\n    }\n};\nexport default checkKeyType;\n","import { encoder, concat, uint32be, lengthAndInput, concatKdf } from '../lib/buffer_utils.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport digest from './digest.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport const deriveKey = async (publicKey, privateKey, algorithm, keyLength, apu = new Uint8Array(0), apv = new Uint8Array(0)) => {\n    if (!isCryptoKey(publicKey)) {\n        throw new TypeError(invalidKeyInput(publicKey, ...types));\n    }\n    checkEncCryptoKey(publicKey, 'ECDH-ES');\n    if (!isCryptoKey(privateKey)) {\n        throw new TypeError(invalidKeyInput(privateKey, ...types));\n    }\n    checkEncCryptoKey(privateKey, 'ECDH-ES', 'deriveBits', 'deriveKey');\n    const value = concat(lengthAndInput(encoder.encode(algorithm)), lengthAndInput(apu), lengthAndInput(apv), uint32be(keyLength));\n    if (!privateKey.usages.includes('deriveBits')) {\n        throw new TypeError('ECDH-ES private key \"usages\" must include \"deriveBits\"');\n    }\n    const sharedSecret = new Uint8Array(await crypto.subtle.deriveBits({\n        name: 'ECDH',\n        public: publicKey,\n    }, privateKey, Math.ceil(parseInt(privateKey.algorithm.namedCurve.substr(-3), 10) / 8) <<\n        3));\n    return concatKdf(digest, sharedSecret, keyLength, value);\n};\nexport const generateEpk = async (key) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return (await crypto.subtle.generateKey({ name: 'ECDH', namedCurve: key.algorithm.namedCurve }, true, ['deriveBits'])).privateKey;\n};\nexport const ecdhAllowed = (key) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return ['P-256', 'P-384', 'P-521'].includes(key.algorithm.namedCurve);\n};\n","import { toSPKI as exportPublic } from '../runtime/asn1.js';\nimport { toPKCS8 as exportPrivate } from '../runtime/asn1.js';\nimport keyToJWK from '../runtime/key_to_jwk.js';\nexport async function exportSPKI(key) {\n    return exportPublic(key);\n}\nexport async function exportPKCS8(key) {\n    return exportPrivate(key);\n}\nexport async function exportJWK(key) {\n    return keyToJWK(key);\n}\n","import crypto, { isCryptoKey } from './webcrypto.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { encode as base64url } from './base64url.js';\nimport { types } from './is_key_like.js';\nconst keyToJWK = async (key) => {\n    if (key instanceof Uint8Array) {\n        return {\n            kty: 'oct',\n            k: base64url(key),\n        };\n    }\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (!key.extractable) {\n        throw new TypeError('non-extractable CryptoKey cannot be exported as a JWK');\n    }\n    const { ext, key_ops, alg, use, ...jwk } = await crypto.subtle.exportKey('jwk', key);\n    return jwk;\n};\nexport default keyToJWK;\n","import subtleAlgorithm from './subtle_rsaes.js';\nimport bogusWebCrypto from './bogus.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport checkKeyLength from './check_key_length.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport const encrypt = async (alg, key, cek) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    checkEncCryptoKey(key, alg, 'encrypt', 'wrapKey');\n    checkKeyLength(alg, key);\n    if (key.usages.includes('encrypt')) {\n        return new Uint8Array(await crypto.subtle.encrypt(subtleAlgorithm(alg), key, cek));\n    }\n    if (key.usages.includes('wrapKey')) {\n        const cryptoKeyCek = await crypto.subtle.importKey('raw', cek, ...bogusWebCrypto);\n        return new Uint8Array(await crypto.subtle.wrapKey('raw', cryptoKeyCek, key, subtleAlgorithm(alg)));\n    }\n    throw new TypeError('RSA-OAEP key \"usages\" must include \"encrypt\" or \"wrapKey\" for this operation');\n};\nexport const decrypt = async (alg, key, encryptedKey) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    checkEncCryptoKey(key, alg, 'decrypt', 'unwrapKey');\n    checkKeyLength(alg, key);\n    if (key.usages.includes('decrypt')) {\n        return new Uint8Array(await crypto.subtle.decrypt(subtleAlgorithm(alg), key, encryptedKey));\n    }\n    if (key.usages.includes('unwrapKey')) {\n        const cryptoKeyCek = await crypto.subtle.unwrapKey('raw', encryptedKey, key, subtleAlgorithm(alg), ...bogusWebCrypto);\n        return new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKeyCek));\n    }\n    throw new TypeError('RSA-OAEP key \"usages\" must include \"decrypt\" or \"unwrapKey\" for this operation');\n};\n","export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n","import random from './random.js';\nimport { p2s as concatSalt } from '../lib/buffer_utils.js';\nimport { encode as base64url } from './base64url.js';\nimport { wrap, unwrap } from './aeskw.js';\nimport checkP2s from '../lib/check_p2s.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nfunction getCryptoKey(key, alg) {\n    if (key instanceof Uint8Array) {\n        return crypto.subtle.importKey('raw', key, 'PBKDF2', false, ['deriveBits']);\n    }\n    if (isCryptoKey(key)) {\n        checkEncCryptoKey(key, alg, 'deriveBits', 'deriveKey');\n        return key;\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n}\nasync function deriveKey(p2s, alg, p2c, key) {\n    checkP2s(p2s);\n    const salt = concatSalt(alg, p2s);\n    const keylen = parseInt(alg.substr(13, 3), 10);\n    const subtleAlg = {\n        hash: `SHA-${alg.substr(8, 3)}`,\n        iterations: p2c,\n        name: 'PBKDF2',\n        salt,\n    };\n    const wrapAlg = {\n        length: keylen,\n        name: 'AES-KW',\n    };\n    const cryptoKey = await getCryptoKey(key, alg);\n    if (cryptoKey.usages.includes('deriveBits')) {\n        return new Uint8Array(await crypto.subtle.deriveBits(subtleAlg, cryptoKey, keylen));\n    }\n    if (cryptoKey.usages.includes('deriveKey')) {\n        return crypto.subtle.deriveKey(subtleAlg, cryptoKey, wrapAlg, false, ['wrapKey', 'unwrapKey']);\n    }\n    throw new TypeError('PBKDF2 key \"usages\" must include \"deriveBits\" or \"deriveKey\"');\n}\nexport const encrypt = async (alg, key, cek, p2c = Math.floor(Math.random() * 2049) + 2048, p2s = random(new Uint8Array(16))) => {\n    const derived = await deriveKey(p2s, alg, p2c, key);\n    const encryptedKey = await wrap(alg.substr(-6), derived, cek);\n    return { encryptedKey, p2c, p2s: base64url(p2s) };\n};\nexport const decrypt = async (alg, key, encryptedKey, p2c, p2s) => {\n    const derived = await deriveKey(p2s, alg, p2c, key);\n    return unwrap(alg.substr(-6), derived, encryptedKey);\n};\n","import { JWEInvalid } from '../util/errors.js';\nexport default function checkP2s(p2s) {\n    if (!(p2s instanceof Uint8Array) || p2s.length < 8) {\n        throw new JWEInvalid('PBES2 Salt Input must be 8 or more octets');\n    }\n}\n","import encrypt from '../runtime/encrypt.js';\nimport decrypt from '../runtime/decrypt.js';\nimport generateIv from './iv.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nexport async function wrap(alg, key, cek, iv) {\n    const jweAlgorithm = alg.substr(0, 7);\n    iv || (iv = generateIv(jweAlgorithm));\n    const { ciphertext: encryptedKey, tag } = await encrypt(jweAlgorithm, cek, key, iv, new Uint8Array(0));\n    return { encryptedKey, iv: base64url(iv), tag: base64url(tag) };\n}\nexport async function unwrap(alg, key, encryptedKey, iv, tag) {\n    const jweAlgorithm = alg.substr(0, 7);\n    return decrypt(jweAlgorithm, key, encryptedKey, iv, tag, new Uint8Array(0));\n}\n","import { encode as base64url } from '../../runtime/base64url.js';\nimport encrypt from '../../runtime/encrypt.js';\nimport { deflate } from '../../runtime/zlib.js';\nimport generateIv from '../../lib/iv.js';\nimport encryptKeyManagement from '../../lib/encrypt_key_management.js';\nimport { JOSENotSupported, JWEInvalid } from '../../util/errors.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport validateCrit from '../../lib/validate_crit.js';\nexport const unprotected = Symbol();\nexport class FlattenedEncrypt {\n    constructor(plaintext) {\n        if (!(plaintext instanceof Uint8Array)) {\n            throw new TypeError('plaintext must be an instance of Uint8Array');\n        }\n        this._plaintext = plaintext;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setSharedUnprotectedHeader(sharedUnprotectedHeader) {\n        if (this._sharedUnprotectedHeader) {\n            throw new TypeError('setSharedUnprotectedHeader can only be called once');\n        }\n        this._sharedUnprotectedHeader = sharedUnprotectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    setAdditionalAuthenticatedData(aad) {\n        this._aad = aad;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    async encrypt(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader && !this._sharedUnprotectedHeader) {\n            throw new JWEInvalid('either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()');\n        }\n        if (!isDisjoint(this._protectedHeader, this._unprotectedHeader, this._sharedUnprotectedHeader)) {\n            throw new JWEInvalid('JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n            ...this._sharedUnprotectedHeader,\n        };\n        validateCrit(JWEInvalid, new Map(), options === null || options === void 0 ? void 0 : options.crit, this._protectedHeader, joseHeader);\n        if (joseHeader.zip !== undefined) {\n            if (!this._protectedHeader || !this._protectedHeader.zip) {\n                throw new JWEInvalid('JWE \"zip\" (Compression Algorithm) Header MUST be integrity protected');\n            }\n            if (joseHeader.zip !== 'DEF') {\n                throw new JOSENotSupported('Unsupported JWE \"zip\" (Compression Algorithm) Header Parameter value');\n            }\n        }\n        const { alg, enc } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWEInvalid('JWE \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        if (typeof enc !== 'string' || !enc) {\n            throw new JWEInvalid('JWE \"enc\" (Encryption Algorithm) Header Parameter missing or invalid');\n        }\n        let encryptedKey;\n        if (alg === 'dir') {\n            if (this._cek) {\n                throw new TypeError('setContentEncryptionKey cannot be called when using Direct Encryption');\n            }\n        }\n        else if (alg === 'ECDH-ES') {\n            if (this._cek) {\n                throw new TypeError('setContentEncryptionKey cannot be called when using Direct Key Agreement');\n            }\n        }\n        let cek;\n        {\n            let parameters;\n            ({ cek, encryptedKey, parameters } = await encryptKeyManagement(alg, enc, key, this._cek, this._keyManagementParameters));\n            if (parameters) {\n                if (options && unprotected in options) {\n                    if (!this._unprotectedHeader) {\n                        this.setUnprotectedHeader(parameters);\n                    }\n                    else {\n                        this._unprotectedHeader = { ...this._unprotectedHeader, ...parameters };\n                    }\n                }\n                else {\n                    if (!this._protectedHeader) {\n                        this.setProtectedHeader(parameters);\n                    }\n                    else {\n                        this._protectedHeader = { ...this._protectedHeader, ...parameters };\n                    }\n                }\n            }\n        }\n        this._iv || (this._iv = generateIv(enc));\n        let additionalData;\n        let protectedHeader;\n        let aadMember;\n        if (this._protectedHeader) {\n            protectedHeader = encoder.encode(base64url(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = encoder.encode('');\n        }\n        if (this._aad) {\n            aadMember = base64url(this._aad);\n            additionalData = concat(protectedHeader, encoder.encode('.'), encoder.encode(aadMember));\n        }\n        else {\n            additionalData = protectedHeader;\n        }\n        let ciphertext;\n        let tag;\n        if (joseHeader.zip === 'DEF') {\n            const deflated = await ((options === null || options === void 0 ? void 0 : options.deflateRaw) || deflate)(this._plaintext);\n            ({ ciphertext, tag } = await encrypt(enc, deflated, cek, this._iv, additionalData));\n        }\n        else {\n            ;\n            ({ ciphertext, tag } = await encrypt(enc, this._plaintext, cek, this._iv, additionalData));\n        }\n        const jwe = {\n            ciphertext: base64url(ciphertext),\n            iv: base64url(this._iv),\n            tag: base64url(tag),\n        };\n        if (encryptedKey) {\n            jwe.encrypted_key = base64url(encryptedKey);\n        }\n        if (aadMember) {\n            jwe.aad = aadMember;\n        }\n        if (this._protectedHeader) {\n            jwe.protected = decoder.decode(protectedHeader);\n        }\n        if (this._sharedUnprotectedHeader) {\n            jwe.unprotected = this._sharedUnprotectedHeader;\n        }\n        if (this._unprotectedHeader) {\n            jwe.header = this._unprotectedHeader;\n        }\n        return jwe;\n    }\n}\n","const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n","import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        else if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n","import { FlattenedEncrypt } from '../flattened/encrypt.js';\nexport class CompactEncrypt {\n    constructor(plaintext) {\n        this._flattened = new FlattenedEncrypt(plaintext);\n    }\n    setContentEncryptionKey(cek) {\n        this._flattened.setContentEncryptionKey(cek);\n        return this;\n    }\n    setInitializationVector(iv) {\n        this._flattened.setInitializationVector(iv);\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        this._flattened.setKeyManagementParameters(parameters);\n        return this;\n    }\n    async encrypt(key, options) {\n        const jwe = await this._flattened.encrypt(key, options);\n        return [jwe.protected, jwe.encrypted_key, jwe.iv, jwe.ciphertext, jwe.tag].join('.');\n    }\n}\n","import { importJWK, CompactEncrypt } from \"jose\";\nimport { JweCid, SyfrJwk } from \"./types\";\n\n/**\n * Parse the JWK to a CryptoKey and store both in the keychain\n * @see https://github.com/panva/jose/blob/main/docs/functions/key_import.importJWK.md#readme\n */\nexport async function keyFromJwk(jwk: SyfrJwk) {\n  let key = (await importJWK(jwk, jwk.alg)) as CryptoKey;\n  return key;\n}\n\n/**\n * Returns a compactJwe string\n * @see https://www.rfc-editor.org/rfc/rfc7516.html#section-4.1.12\n * @see https://github.com/panva/jose/blob/main/docs/classes/jwe_compact_encrypt.CompactEncrypt.md#readme\n */\nexport async function makeCompactJwe(\n  jwk: SyfrJwk,\n  key: CryptoKey,\n  cty: string,\n  byteArr: Uint8Array,\n  cids?: JweCid[]\n) {\n  let protectedHeader = {\n    alg: jwk.alg,\n    enc: \"A256GCM\",\n    kid: jwk.kid,\n    cty,\n    cids,\n  };\n  cids ?? delete protectedHeader.cids;\n  let jwe = await new CompactEncrypt(byteArr)\n    .setProtectedHeader(protectedHeader)\n    .encrypt(key);\n  return jwe;\n}\n","import {\n  SyfrDebugEvent,\n  SyfrValidEvent,\n  SyfrRequestEvent,\n  SyfrTransmitEvent,\n} from \"./types\";\n\n/**\n * Each static function creates a CustomEvent and immediately dispatches\n * These should be called by SyfrForm according to the timing indicated\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#events\n * @see SyfrForm\n *\n * @example\n * window.addEventListener(\"DOMContentLoaded\", (event) => {\n *\n * // automatically attempt to use Syfr for all forms on the page\n * Array.from(document.forms).forEach((form) => {\n *\n *   // output debug events so you can see what is happening on the form\n *   form.addEventListener(\"debug\", (event) => {\n *     console.log(\"debugEvent\", event.detail);\n *   });\n *\n *   // output the data being sent to Syfr\n *   form.addEventListener(\"protect\", (event) => {\n *     console.log(\"protectEvent\", event.detail);\n *     // or perhaps activate a lock icon on the form that shows the encryption seal\n *   });\n *\n *   // get the XMLHttpRequest to monitor those events on this form\n *   form.addEventListener(\"request\", (event) => {\n *     for (var key in event.detail) {\n *\n *       // output ALL events emitted from XMLHttpRequest for this form\n *       if (key.search(\"on\") === 0) {\n *         event.detail.addEventListener(key.slice(2), (event) => {\n *           console.log(\"XHR Event\", event);\n *           // or perhaps show the % uploaded in a progress bar\n *           // or perhaps change submit button to a spinner from `loadstart` until `loadend`\n *         });\n *       }\n *     }\n *   });\n *\n *   // output the data being sent to Syfr\n *   form.addEventListener(\"transmit\", (event) => {\n *     console.log(\"transmitEvent\", event.detail);\n *     // generaully this should not be used\n *   });\n * });\n * });\n *\n * @note to set custom validation constraints:\n * @example\n * let myForm = document.getElementById(\"myForm\") // to manage a specific form\n * let lastName = document.getElementById(\"last-name\");\n * if(lastName.value instanceOf number){\n *   lastName.setCustomValidity(\"Cannot be a number\");\n *   myForm.querySelector('[type=\"submit\"]').toggleAttribute(\"disabled\");\n * }\n *\n * @note perhaps disable submit by default and enable when form is in a valid state\n * @see https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Constraint_validation\n */\nexport class SyfrEvent {\n  static debug(form: HTMLFormElement, detail: SyfrDebugEvent[\"detail\"]) {\n    form.dispatchEvent(new CustomEvent(\"debug\", { detail }) as SyfrDebugEvent);\n  }\n\n  static valid(form: HTMLFormElement, detail?: SyfrValidEvent[\"detail\"]) {\n    form.dispatchEvent(new CustomEvent(\"valid\", { detail }) as SyfrValidEvent);\n  }\n\n  static transmit(form: HTMLFormElement, detail: SyfrTransmitEvent[\"detail\"]) {\n    form.dispatchEvent(\n      new CustomEvent(\"transmit\", { detail }) as SyfrTransmitEvent\n    );\n  }\n\n  static request(form: HTMLFormElement, detail: SyfrRequestEvent[\"detail\"]) {\n    form.dispatchEvent(\n      new CustomEvent(\"request\", { detail }) as SyfrRequestEvent\n    );\n  }\n}\n","import { keyFromJwk, makeCompactJwe } from \"./encrypt\";\nimport { SyfrEvent } from \"./event\";\nimport { fetchJwk, pushToApi } from \"./request\";\nimport {\n  CompactJwe,\n  FileJweMeta,\n  JweCid,\n  JweMap,\n  SyfrJweContent,\n  SyfrJwk,\n  Uuid,\n} from \"./types\";\n\n/**\n * Automatically initialized when script is included.\n * Use event listeners to enhance user experience\n * @see SyfrEvent\n */\nexport class SyfrClass {\n  id: Uuid; // the UUID of the form in Syfr\n  form: HTMLFormElement; // the DOM representation of the form\n  pubKey?: CryptoKey; // the CryptoKey from the JWK to encrypt the formdata\n  pubJwk?: SyfrJwk; // the JWK from Syfr to encrypt the formdata\n  jwes: JweMap = {}; // the JWEs which will be submitted to Syfr\n  loading: boolean = false;\n\n  constructor(\n    form: SyfrClass[\"form\"],\n    syfrId?: Uuid,\n    anchor?: HTMLAnchorElement\n  ) {\n    this.form = form;\n    this.id = syfrId ?? form.dataset.syfrId ?? \"\";\n    this.idCheck() && this.linkCheck(anchor) && this.autoSubmit();\n  }\n\n  idCheck() {\n    if (this.id === undefined) {\n      SyfrEvent.debug(this.form, {\n        form: this.form,\n        message: \"Ignoring; no data-syfr-id attribute\",\n      });\n      return false;\n    }\n    return true;\n  }\n\n  linkCheck(anchor?: HTMLAnchorElement) {\n    let href = `https://syfr.app/validate/${this.id}`;\n    let linkEl = anchor ?? this.form.querySelector(\"[data-syfr-validate]\");\n    let issues = {\n      ...(!linkEl && {\n        linkMissing: { got: linkEl, want: `<a data-syfr-validate ...` },\n      }),\n      ...(!(linkEl instanceof HTMLAnchorElement) && {\n        linkHref: { got: linkEl, want: `<a href='${href}' ...` },\n      }),\n      ...(!this.form.contains(linkEl) && {\n        linkWithinForm: { got: false, want: true },\n      }),\n      ...(!this.id.match(\n        /^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i\n      ) && { syfrId: { got: this.id, want: \"a valid uuid from Syfr\" } }),\n    };\n    if (Object.keys(issues).length < 1 && linkEl instanceof HTMLAnchorElement) {\n      let cs = getComputedStyle(linkEl);\n      let pf = parseFloat;\n      let px = pf(cs.paddingLeft) + pf(cs.paddingRight);\n      let py = pf(cs.paddingTop) + pf(cs.paddingBottom);\n      let bx = pf(cs.borderLeftWidth) + pf(cs.borderRightWidth);\n      let by = pf(cs.borderTopWidth) + pf(cs.borderBottomWidth);\n      let heightPx = linkEl.offsetHeight - px - bx;\n      let widthPx = linkEl.offsetWidth - py - by;\n      let areaPx = heightPx * widthPx;\n      let fontSizePx = pf(cs.fontSize);\n      issues = {\n        ...issues,\n        ...(linkEl.offsetParent === null && {\n          validationLinkIsHidden: { got: true, want: false },\n        }),\n        ...(linkEl.href != href && {\n          validationLinkHref: { got_: linkEl.href, want: href },\n        }),\n        ...(linkEl.relList.contains(\"nofollow\") && {\n          validationLinkIsNofollow: { got: true, want: false },\n        }),\n        ...(linkEl.relList.contains(\"noreferrer\") && {\n          validationLinkIsNoreferrer: { got: true, want: false },\n        }),\n        ...(areaPx < 1536 && {\n          validationLinkArea: { got: areaPx, want: 1536 },\n        }),\n        ...(fontSizePx < 8 && {\n          validationLinkFontSizePx: { got: fontSizePx, want: \"8px+\" },\n        }),\n      };\n    }\n    if (Object.keys(issues).length > 0) {\n      throw {\n        form: this.form,\n        link: linkEl,\n        issues,\n        error: `We can't protect your form because of the issues listed`,\n        seeDocs: \"https://syfr.app/docs/validation\",\n      };\n    }\n    return true;\n  }\n\n  async getJwk() {\n    if (this.pubJwk) {\n      return this.pubJwk;\n    }\n    try {\n      return await fetchJwk(this.id);\n    } catch (e) {\n      throw {\n        syfrId: this.id,\n        error: \"Bad data-syfr-id or couldn't get pubKey\",\n      };\n    }\n  }\n\n  async getKey() {\n    if (this.pubKey) {\n      return this.pubKey;\n    }\n    let pubJwk = await this.getJwk();\n    this.pubKey = await keyFromJwk(pubJwk);\n    SyfrEvent.valid(this.form, {\n      id: this.id,\n      validateUrl: `https://syfr.app/validate/${this.id}`,\n    });\n    SyfrEvent.debug(this.form, {\n      id: this.id,\n      formPubKey: this.pubKey,\n      message:\n        \"use addEventListener('protected',(event)=>{...} to notify your users of the protection\",\n    });\n    return this.pubKey;\n  }\n\n  /**\n   * Listens for the form submit (the SubmitEvent only fires if it succeeds validation)\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit_event\n   */\n  autoSubmit() {\n    SyfrEvent.debug(this.form, {\n      message: \"Initializing SyfrClass\",\n      syfrId: this.id,\n      form: this.form,\n    });\n    this.getKey();\n    this.form.addEventListener(\"submit\", async (event: SubmitEvent) => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      event.stopPropagation();\n      if (this.loading) {\n        SyfrEvent.debug(this.form, \"Ignored duplicate submission.\");\n        return;\n      }\n      this.loading = true;\n      await this.submit();\n      this.form.reset();\n      this.jwes = {};\n      this.loading = false;\n    });\n  }\n\n  async submit() {\n    this.pubKey || (await this.getKey());\n    await this.buildEntry();\n    await this.sendToSyfr();\n  }\n\n  async buildEntry() {\n    let code = this.getCode();\n    let data = await this.getData();\n    await this.buildRootJwe({ code, data });\n  }\n\n  /**\n   * Serialize the form HTML to a string\n   * already considered and rejected https://developer.mozilla.org/en-US/docs/Web/API/DOMParser\n   */\n  getCode() {\n    return new XMLSerializer()\n      .serializeToString(this.form)\n      .replace(/\\s{2,}/g, \" \"); //remove extra spacing\n  }\n\n  async getData() {\n    let srcFormData = new FormData(this.form);\n    let result: SyfrJweContent[\"data\"] = {};\n    for (let fieldName of srcFormData.keys()) {\n      if (fieldName in result) {\n        continue; //skip duplicate key (ex: a field can have multiple files using same key)\n      }\n      let fieldArr = srcFormData.getAll(fieldName);\n      let parsed = await this.getParsedFieldArr(fieldArr);\n      // use srcFormData to determine if output should be an array\n      result[fieldName] = fieldArr.length > 1 ? parsed : parsed[0];\n    }\n    return result;\n  }\n\n  async buildRootJwe(stringifiableObj: object) {\n    const pubJwk = await this.getJwk();\n    const pubKey = await this.getKey();\n    const byteArr = new TextEncoder().encode(JSON.stringify(stringifiableObj));\n    const rootJwe = await makeCompactJwe(\n      pubJwk,\n      pubKey,\n      \"application/json\",\n      byteArr,\n      Object.keys(this.jwes)\n    );\n    this.jwes[this.jweToCid(rootJwe)] = rootJwe;\n  }\n\n  async getParsedFieldArr(fieldArr: FormDataEntryValue[]) {\n    let response = [];\n    for (let field of fieldArr) {\n      response.push(await this.getParsedField(field));\n    }\n    return response;\n  }\n\n  async getParsedField(field: FormDataEntryValue) {\n    return field instanceof File ? await this.processFile(field) : field;\n  }\n\n  async processFile(file: File) {\n    const pubJwk = await this.getJwk();\n    const pubKey = await this.getKey();\n    if (file.size > 0) {\n      let fileJwe = await makeCompactJwe(\n        pubJwk,\n        pubKey,\n        file.type,\n        await this.fileToUint8(file)\n      );\n      this.jwes[this.jweToCid(fileJwe)] = fileJwe;\n      return this.fileToMeta(file, fileJwe);\n    }\n  }\n\n  async fileToUint8(file: File) {\n    let buf = await file.arrayBuffer();\n    return new Uint8Array(buf);\n  }\n\n  /**\n   * Drops file streams (no .t`ex`t(), no .arrayBuffer(), .etc)\n   */\n  fileToMeta(file: File, jwe: CompactJwe) {\n    let { name, lastModified, type } = file;\n    let fileJweMeta: FileJweMeta = {\n      name,\n      lastModified,\n      type,\n      cids: [this.jweToCid(jwe)], // plural for future chunking.\n    };\n    return fileJweMeta;\n  }\n\n  jweToCid(jwe: CompactJwe): JweCid {\n    let response = jwe.split(\".\")[4];\n    if (!response) throw \"Provided JWE was invalid\";\n    return response;\n  }\n\n  async sendToSyfr() {\n    let payload = new FormData();\n    Object.values(this.jwes).forEach((jwe) => {\n      payload.append(\"compactJwe\", jwe);\n    });\n    SyfrEvent.transmit(this.form, { jwes: this.jwes, payload });\n    SyfrEvent.debug(this.form, {\n      message: \"Sending to Syfr:\",\n      jwes: this.jwes,\n      payload,\n    });\n    await pushToApi(payload, this.form);\n  }\n}\n","import { SyfrJwk } from \"./types\";\n\n/**\n * @see https://github.com/syfrapp/api/issues/101\n */\nexport async function fetchJwk(id: string) {\n  let response = await fetch(\n    \"https://develop-api.syfr.app/rest/pub/form/\" + id,\n    { method: \"GET\", mode: \"no-cors\" }\n  );\n  let result = await response.json();\n  return result.publicJwk as SyfrJwk;\n}\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n * @see https://github.com/syfrapp/api/issues/103\n */\nexport async function pushToApi(payload: FormData, form: HTMLFormElement) {\n  let request = new XMLHttpRequest();\n  form.dispatchEvent(new CustomEvent(\"request\", { detail: request }));\n  request.open(\"POST\", \"https://develop-api.syfr.app/rest/pub/entry\");\n  request.send(payload);\n}\n","import { decode as decodeBase64URL, encodeBase64, decodeBase64 } from '../runtime/base64url.js';\nimport { fromSPKI as importPublic } from '../runtime/asn1.js';\nimport { fromPKCS8 as importPrivate } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport formatPEM from '../lib/format_pem.js';\nimport isObject from '../lib/is_object.js';\nfunction getElement(seq) {\n    let result = [];\n    let next = 0;\n    while (next < seq.length) {\n        let nextPart = parseElement(seq.subarray(next));\n        result.push(nextPart);\n        next += nextPart.byteLength;\n    }\n    return result;\n}\nfunction parseElement(bytes) {\n    let position = 0;\n    let tag = bytes[0] & 0x1f;\n    position++;\n    if (tag === 0x1f) {\n        tag = 0;\n        while (bytes[position] >= 0x80) {\n            tag = tag * 128 + bytes[position] - 0x80;\n            position++;\n        }\n        tag = tag * 128 + bytes[position] - 0x80;\n        position++;\n    }\n    let length = 0;\n    if (bytes[position] < 0x80) {\n        length = bytes[position];\n        position++;\n    }\n    else {\n        let numberOfDigits = bytes[position] & 0x7f;\n        position++;\n        length = 0;\n        for (let i = 0; i < numberOfDigits; i++) {\n            length = length * 256 + bytes[position];\n            position++;\n        }\n    }\n    if (length === 0x80) {\n        length = 0;\n        while (bytes[position + length] !== 0 || bytes[position + length + 1] !== 0) {\n            length++;\n        }\n        const byteLength = position + length + 2;\n        return {\n            byteLength,\n            contents: bytes.subarray(position, position + length),\n            raw: bytes.subarray(0, byteLength),\n        };\n    }\n    const byteLength = position + length;\n    return {\n        byteLength,\n        contents: bytes.subarray(position, byteLength),\n        raw: bytes.subarray(0, byteLength),\n    };\n}\nfunction spkiFromX509(buf) {\n    const tbsCertificate = getElement(getElement(parseElement(buf).contents)[0].contents);\n    return encodeBase64(tbsCertificate[tbsCertificate[0].raw[0] === 0xa0 ? 6 : 5].raw);\n}\nfunction getSPKI(x509) {\n    const pem = x509.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\\s)/g, '');\n    const raw = decodeBase64(pem);\n    return formatPEM(spkiFromX509(raw), 'PUBLIC KEY');\n}\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return importPublic(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    const spki = getSPKI(x509);\n    return importPublic(spki, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PCKS8 formatted string');\n    }\n    return importPrivate(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg, octAsKeyObject) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    if (typeof alg !== 'string' || !alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            octAsKeyObject !== null && octAsKeyObject !== void 0 ? octAsKeyObject : (octAsKeyObject = jwk.ext !== true);\n            if (octAsKeyObject) {\n                return asKeyObject({ ...jwk, alg, ext: false });\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if (jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n","function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n","import { SyfrClass } from \"./class\";\n\nexport function SyfrForm({ id, Form }: { id: string; Form: HTMLFormElement }) {\n  new SyfrClass(Form, id);\n  return Form;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["TextEncoder","TextDecoder","MAX_INT32","buffers","size","reduce","acc","length","buf","Uint8Array","i","forEach","buffer","set","writeUInt32BE","value","offset","RangeError","uint32be","lengthAndInput","input","encode","unencoded","arr","push","String","fromCharCode","apply","subarray","btoa","join","replace","decode","encoded","atob","split","map","c","charCodeAt","_a","TypeError","Error","constructor","message","super","this","code","name","captureStackTrace","call","arguments","key","extractable","algorithm","type","bitLength","alg","cek","expected","deflate","async","hash","unusable","prop","isAlgorithm","usages","parseInt","substr","some","includes","msg","last","pop","checkUsage","actual","types","wrap","cryptoKey","usage","getCryptoKey","checkKeySize","cryptoKeyCek","bogus","data","subtleDigest","subtleRsaEs","undefined","process","versions","node","jwk","_b","keyUsages","kty","d","namedCurve","crv","WebSocketPair","subtleMapping","rest","ext","key_ops","k","keyData","enc","plaintext","iv","aad","keySize","encKey","macKey","ciphertext","macData","high","Math","floor","low","tag","slice","cbcEncrypt","encrypted","additionalData","tagLength","gcmEncrypt","providedCek","providedParameters","encryptedKey","parameters","startsWith","test","symmetricTypeCheck","asymmetricTypeCheck","apu","apv","epk","ephemeralKey","privateKey","x","y","use","exportJWK","sharedSecret","publicKey","keyLength","public","ceil","digest","secret","bits","iterations","res","iter","concatKdf","kwAlg","modulusLength","p2c","p2s","random","derived","checkP2s","salt","p2sInput","keylen","subtleAlg","wrapAlg","jweAlgorithm","Symbol","_plaintext","setKeyManagementParameters","_keyManagementParameters","setProtectedHeader","protectedHeader","_protectedHeader","setSharedUnprotectedHeader","sharedUnprotectedHeader","_sharedUnprotectedHeader","setUnprotectedHeader","unprotectedHeader","_unprotectedHeader","setAdditionalAuthenticatedData","_aad","setContentEncryptionKey","_cek","setInitializationVector","_iv","options","headers","sources","filter","Boolean","header","Object","keys","parameter","has","add","Set","joseHeader","Err","recognizedDefault","recognizedOption","crit","Array","isArray","recognized","Map","entries","get","zip","aadMember","JSON","stringify","deflated","deflateRaw","jwe","encrypted_key","protected","unprotected","_flattened","encrypt","makeCompactJwe","cty","byteArr","cids","kid","SyfrEvent","static","form","detail","dispatchEvent","CustomEvent","SyfrClass","syfrId","anchor","jwes","loading","id","dataset","idCheck","linkCheck","autoSubmit","debug","href","linkEl","querySelector","issues","linkMissing","got","want","HTMLAnchorElement","linkHref","contains","linkWithinForm","match","cs","getComputedStyle","pf","parseFloat","px","paddingLeft","paddingRight","py","paddingTop","paddingBottom","bx","borderLeftWidth","borderRightWidth","by","borderTopWidth","borderBottomWidth","areaPx","offsetHeight","offsetWidth","fontSizePx","fontSize","offsetParent","validationLinkIsHidden","validationLinkHref","got_","relList","validationLinkIsNofollow","validationLinkIsNoreferrer","validationLinkArea","validationLinkFontSizePx","link","error","seeDocs","pubJwk","response","fetch","method","mode","json","publicJwk","fetchJwk","e","pubKey","getJwk","octAsKeyObject","prototype","toString","getPrototypeOf","proto","oth","keyFromJwk","valid","validateUrl","formPubKey","getKey","addEventListener","event","preventDefault","stopImmediatePropagation","stopPropagation","submit","reset","buildEntry","sendToSyfr","getCode","getData","buildRootJwe","XMLSerializer","serializeToString","srcFormData","FormData","result","fieldName","fieldArr","getAll","parsed","getParsedFieldArr","stringifiableObj","rootJwe","jweToCid","field","getParsedField","File","processFile","file","fileJwe","fileToUint8","fileToMeta","arrayBuffer","lastModified","payload","values","append","transmit","request","XMLHttpRequest","open","send","pushToApi","SyfrForm","Form","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","o","defineProperty","enumerable","obj","hasOwnProperty","r","toStringTag"],"sourceRoot":""}