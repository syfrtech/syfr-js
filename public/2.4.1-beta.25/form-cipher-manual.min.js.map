{"version":3,"file":"2.4.1-beta.25/form-cipher-manual.min.js","mappings":"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","sources":["webpack://Syfr/webpack/bootstrap","webpack://Syfr/webpack/runtime/define property getters","webpack://Syfr/webpack/runtime/hasOwnProperty shorthand","webpack://Syfr/webpack/runtime/make namespace object","webpack://Syfr/./node_modules/jose/dist/browser/lib/buffer_utils.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/base64url.js","webpack://Syfr/./node_modules/jose/dist/browser/util/errors.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/webcrypto.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/random.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/iv.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/check_cek_length.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/is_key_like.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/zlib.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/bogus.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/crypto_key.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/invalid_key_input.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/aeskw.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/digest.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/subtle_rsaes.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/cek.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/env.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/jwk_to_key.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/encrypt.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/check_iv_length.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/encrypt_key_management.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/check_key_type.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/ecdhes.js","webpack://Syfr/./node_modules/jose/dist/browser/key/export.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/key_to_jwk.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/rsaes.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/check_key_length.js","webpack://Syfr/./node_modules/jose/dist/browser/runtime/pbes2kw.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/check_p2s.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/aesgcmkw.js","webpack://Syfr/./node_modules/jose/dist/browser/jwe/flattened/encrypt.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/is_disjoint.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/validate_crit.js","webpack://Syfr/./node_modules/jose/dist/browser/jwe/compact/encrypt.js","webpack://Syfr/./src/encrypt.ts","webpack://Syfr/./src/event.ts","webpack://Syfr/./src/class.ts","webpack://Syfr/./src/request.ts","webpack://Syfr/./node_modules/jose/dist/browser/key/import.js","webpack://Syfr/./node_modules/jose/dist/browser/lib/is_object.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    buffers.forEach((buffer) => {\n        buf.set(buffer, i);\n        i += buffer.length;\n    });\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(digest, secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    let res;\n    for (let iter = 1; iter <= iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        if (!res) {\n            res = await digest('sha256', buf);\n        }\n        else {\n            res = concat(res, await digest('sha256', buf));\n        }\n    }\n    res = res.slice(0, bits >> 3);\n    return res;\n}\n","import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    return new Uint8Array(atob(encoded)\n        .split('')\n        .map((c) => c.charCodeAt(0)));\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch (_a) {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n","export class JOSEError extends Error {\n    constructor(message) {\n        var _a;\n        super(message);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        (_a = Error.captureStackTrace) === null || _a === void 0 ? void 0 : _a.call(Error, this, this.constructor);\n    }\n    static get code() {\n        return 'ERR_JOSE_GENERIC';\n    }\n}\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, claim = 'unspecified', reason = 'unspecified') {\n        super(message);\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n    }\n    static get code() {\n        return 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    }\n}\nexport class JWTExpired extends JOSEError {\n    constructor(message, claim = 'unspecified', reason = 'unspecified') {\n        super(message);\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n    }\n    static get code() {\n        return 'ERR_JWT_EXPIRED';\n    }\n}\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n    static get code() {\n        return 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n    static get code() {\n        return 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n        this.message = 'decryption operation failed';\n    }\n    static get code() {\n        return 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWE_INVALID';\n    }\n}\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWS_INVALID';\n    }\n}\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWT_INVALID';\n    }\n}\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWK_INVALID';\n    }\n}\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n    static get code() {\n        return 'ERR_JWKS_INVALID';\n    }\n}\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n        this.message = 'no applicable key found in the JSON Web Key Set';\n    }\n    static get code() {\n        return 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n        this.message = 'multiple matching keys found in the JSON Web Key Set';\n    }\n    static get code() {\n        return 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nexport class JWKSTimeout extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_TIMEOUT';\n        this.message = 'request timed out';\n    }\n    static get code() {\n        return 'ERR_JWKS_TIMEOUT';\n    }\n}\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n        this.message = 'signature verification failed';\n    }\n    static get code() {\n        return 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\n","export default crypto;\nexport function isCryptoKey(key) {\n    try {\n        return (key != null &&\n            typeof key.extractable === 'boolean' &&\n            typeof key.algorithm.name === 'string' &&\n            typeof key.type === 'string');\n    }\n    catch (_a) {\n        return false;\n    }\n}\n","import crypto from './webcrypto.js';\nexport default crypto.getRandomValues.bind(crypto);\n","import { JOSENotSupported } from '../util/errors.js';\nimport random from '../runtime/random.js';\nexport function bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A128GCMKW':\n        case 'A192GCM':\n        case 'A192GCMKW':\n        case 'A256GCM':\n        case 'A256GCMKW':\n            return 96;\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            return 128;\n        default:\n            throw new JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexport default (alg) => random(new Uint8Array(bitLength(alg) >> 3));\n","import { JWEInvalid } from '../util/errors.js';\nconst checkCekLength = (cek, expected) => {\n    if (cek.length << 3 !== expected) {\n        throw new JWEInvalid('Invalid Content Encryption Key length');\n    }\n};\nexport default checkCekLength;\n","import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    return isCryptoKey(key);\n};\nexport const types = ['CryptoKey'];\n","import { JOSENotSupported } from '../util/errors.js';\nexport const inflate = async () => {\n    throw new JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.');\n};\nexport const deflate = async () => {\n    throw new JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.');\n};\n","const bogusWebCrypto = [\n    { hash: 'SHA-256', name: 'HMAC' },\n    true,\n    ['sign'],\n];\nexport default bogusWebCrypto;\n","import { isCloudflareWorkers, isNodeJs } from '../runtime/env.js';\nfunction unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.substr(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.substr(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.substr(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.substr(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case isNodeJs() && 'EdDSA': {\n            if (key.algorithm.name !== 'NODE-ED25519' && key.algorithm.name !== 'NODE-ED448')\n                throw unusable('NODE-ED25519 or NODE-ED448');\n            break;\n        }\n        case isCloudflareWorkers() && 'EdDSA': {\n            if (!isAlgorithm(key.algorithm, 'NODE-ED25519'))\n                throw unusable('NODE-ED25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.substr(1, 3), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.substr(1, 3), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH-ES':\n            if (!isAlgorithm(key.algorithm, 'ECDH'))\n                throw unusable('ECDH');\n            break;\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.substr(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n","export default (actual, ...types) => {\n    let msg = 'Key must be ';\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor && actual.constructor.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n};\n","import bogusWebCrypto from './bogus.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nfunction checkKeySize(key, alg) {\n    if (key.algorithm.length !== parseInt(alg.substr(1, 3), 10)) {\n        throw new TypeError(`Invalid key size for alg: ${alg}`);\n    }\n}\nfunction getCryptoKey(key, alg, usage) {\n    if (isCryptoKey(key)) {\n        checkEncCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        return crypto.subtle.importKey('raw', key, 'AES-KW', true, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n}\nexport const wrap = async (alg, key, cek) => {\n    const cryptoKey = await getCryptoKey(key, alg, 'wrapKey');\n    checkKeySize(cryptoKey, alg);\n    const cryptoKeyCek = await crypto.subtle.importKey('raw', cek, ...bogusWebCrypto);\n    return new Uint8Array(await crypto.subtle.wrapKey('raw', cryptoKeyCek, cryptoKey, 'AES-KW'));\n};\nexport const unwrap = async (alg, key, encryptedKey) => {\n    const cryptoKey = await getCryptoKey(key, alg, 'unwrapKey');\n    checkKeySize(cryptoKey, alg);\n    const cryptoKeyCek = await crypto.subtle.unwrapKey('raw', encryptedKey, cryptoKey, 'AES-KW', ...bogusWebCrypto);\n    return new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKeyCek));\n};\n","import crypto from './webcrypto.js';\nconst digest = async (algorithm, data) => {\n    const subtleDigest = `SHA-${algorithm.substr(-3)}`;\n    return new Uint8Array(await crypto.subtle.digest(subtleDigest, data));\n};\nexport default digest;\n","import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleRsaEs(alg) {\n    switch (alg) {\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            return 'RSA-OAEP';\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n","import { JOSENotSupported } from '../util/errors.js';\nimport random from '../runtime/random.js';\nexport function bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n            return 128;\n        case 'A192GCM':\n            return 192;\n        case 'A256GCM':\n        case 'A128CBC-HS256':\n            return 256;\n        case 'A192CBC-HS384':\n            return 384;\n        case 'A256CBC-HS512':\n            return 512;\n        default:\n            throw new JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexport default (alg) => random(new Uint8Array(bitLength(alg) >> 3));\n","export function isCloudflareWorkers() {\n    return typeof WebSocketPair === 'function';\n}\nexport function isNodeJs() {\n    try {\n        return process.versions.node !== undefined;\n    }\n    catch (_a) {\n        return false;\n    }\n}\n","import { isCloudflareWorkers, isNodeJs } from './env.js';\nimport crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { decode as base64url } from './base64url.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'oct': {\n            switch (jwk.alg) {\n                case 'HS256':\n                case 'HS384':\n                case 'HS512':\n                    algorithm = { name: 'HMAC', hash: `SHA-${jwk.alg.substr(-3)}` };\n                    keyUsages = ['sign', 'verify'];\n                    break;\n                case 'A128CBC-HS256':\n                case 'A192CBC-HS384':\n                case 'A256CBC-HS512':\n                    throw new JOSENotSupported(`${jwk.alg} keys cannot be imported as CryptoKey instances`);\n                case 'A128GCM':\n                case 'A192GCM':\n                case 'A256GCM':\n                case 'A128GCMKW':\n                case 'A192GCMKW':\n                case 'A256GCMKW':\n                    algorithm = { name: 'AES-GCM' };\n                    keyUsages = ['encrypt', 'decrypt'];\n                    break;\n                case 'A128KW':\n                case 'A192KW':\n                case 'A256KW':\n                    algorithm = { name: 'AES-KW' };\n                    keyUsages = ['wrapKey', 'unwrapKey'];\n                    break;\n                case 'PBES2-HS256+A128KW':\n                case 'PBES2-HS384+A192KW':\n                case 'PBES2-HS512+A256KW':\n                    algorithm = { name: 'PBKDF2' };\n                    keyUsages = ['deriveBits'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.substr(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.substr(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.substr(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case (isCloudflareWorkers() || isNodeJs()) && 'OKP':\n            if (jwk.alg !== 'EdDSA') {\n                throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            switch (jwk.crv) {\n                case 'Ed25519':\n                    algorithm = { name: 'NODE-ED25519', namedCurve: 'NODE-ED25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case isNodeJs() && 'Ed448':\n                    algorithm = { name: 'NODE-ED448', namedCurve: 'NODE-ED448' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"crv\" (Subtype of Key Pair) Parameter value');\n            }\n            break;\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    var _a, _b;\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        (_a = jwk.ext) !== null && _a !== void 0 ? _a : false,\n        (_b = jwk.key_ops) !== null && _b !== void 0 ? _b : keyUsages,\n    ];\n    if (algorithm.name === 'PBKDF2') {\n        return crypto.subtle.importKey('raw', base64url(jwk.k), ...rest);\n    }\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n","import { concat, uint64be } from '../lib/buffer_utils.js';\nimport checkIvLength from '../lib/check_iv_length.js';\nimport checkCekLength from './check_cek_length.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { types } from './is_key_like.js';\nasync function cbcEncrypt(enc, plaintext, cek, iv, aad) {\n    if (!(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, 'Uint8Array'));\n    }\n    const keySize = parseInt(enc.substr(1, 3), 10);\n    const encKey = await crypto.subtle.importKey('raw', cek.subarray(keySize >> 3), 'AES-CBC', false, ['encrypt']);\n    const macKey = await crypto.subtle.importKey('raw', cek.subarray(0, keySize >> 3), {\n        hash: `SHA-${keySize << 1}`,\n        name: 'HMAC',\n    }, false, ['sign']);\n    const ciphertext = new Uint8Array(await crypto.subtle.encrypt({\n        iv,\n        name: 'AES-CBC',\n    }, encKey, plaintext));\n    const macData = concat(aad, iv, ciphertext, uint64be(aad.length << 3));\n    const tag = new Uint8Array((await crypto.subtle.sign('HMAC', macKey, macData)).slice(0, keySize >> 3));\n    return { ciphertext, tag };\n}\nasync function gcmEncrypt(enc, plaintext, cek, iv, aad) {\n    let encKey;\n    if (cek instanceof Uint8Array) {\n        encKey = await crypto.subtle.importKey('raw', cek, 'AES-GCM', false, ['encrypt']);\n    }\n    else {\n        checkEncCryptoKey(cek, enc, 'encrypt');\n        encKey = cek;\n    }\n    const encrypted = new Uint8Array(await crypto.subtle.encrypt({\n        additionalData: aad,\n        iv,\n        name: 'AES-GCM',\n        tagLength: 128,\n    }, encKey, plaintext));\n    const tag = encrypted.slice(-16);\n    const ciphertext = encrypted.slice(0, -16);\n    return { ciphertext, tag };\n}\nconst encrypt = async (enc, plaintext, cek, iv, aad) => {\n    if (!isCryptoKey(cek) && !(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, ...types, 'Uint8Array'));\n    }\n    checkIvLength(enc, iv);\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            if (cek instanceof Uint8Array)\n                checkCekLength(cek, parseInt(enc.substr(-3), 10));\n            return cbcEncrypt(enc, plaintext, cek, iv, aad);\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            if (cek instanceof Uint8Array)\n                checkCekLength(cek, parseInt(enc.substr(1, 3), 10));\n            return gcmEncrypt(enc, plaintext, cek, iv, aad);\n        default:\n            throw new JOSENotSupported('Unsupported JWE Content Encryption Algorithm');\n    }\n};\nexport default encrypt;\n","import { JWEInvalid } from '../util/errors.js';\nimport { bitLength } from './iv.js';\nconst checkIvLength = (enc, iv) => {\n    if (iv.length << 3 !== bitLength(enc)) {\n        throw new JWEInvalid('Invalid Initialization Vector length');\n    }\n};\nexport default checkIvLength;\n","import { wrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { encrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { encrypt as rsaEs } from '../runtime/rsaes.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nimport generateCek, { bitLength as cekLength } from '../lib/cek.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { exportJWK } from '../key/export.js';\nimport checkKeyType from './check_key_type.js';\nimport { wrap as aesGcmKw } from './aesgcmkw.js';\nasync function encryptKeyManagement(alg, enc, key, providedCek, providedParameters = {}) {\n    let encryptedKey;\n    let parameters;\n    let cek;\n    checkKeyType(alg, key, 'encrypt');\n    switch (alg) {\n        case 'dir': {\n            cek = key;\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!ECDH.ecdhAllowed(key)) {\n                throw new JOSENotSupported('ECDH-ES with the provided key is not allowed or not supported by your javascript runtime');\n            }\n            const { apu, apv } = providedParameters;\n            let { epk: ephemeralKey } = providedParameters;\n            ephemeralKey || (ephemeralKey = await ECDH.generateEpk(key));\n            const { x, y, crv, kty } = await exportJWK(ephemeralKey);\n            const sharedSecret = await ECDH.deriveKey(key, ephemeralKey, alg === 'ECDH-ES' ? enc : alg, alg === 'ECDH-ES' ? cekLength(enc) : parseInt(alg.substr(-5, 3), 10), apu, apv);\n            parameters = { epk: { x, y, crv, kty } };\n            if (apu)\n                parameters.apu = base64url(apu);\n            if (apv)\n                parameters.apv = base64url(apv);\n            if (alg === 'ECDH-ES') {\n                cek = sharedSecret;\n                break;\n            }\n            cek = providedCek || generateCek(enc);\n            const kwAlg = alg.substr(-6);\n            encryptedKey = await aesKw(kwAlg, sharedSecret, cek);\n            break;\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            cek = providedCek || generateCek(enc);\n            encryptedKey = await rsaEs(alg, key, cek);\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            cek = providedCek || generateCek(enc);\n            const { p2c, p2s } = providedParameters;\n            ({ encryptedKey, ...parameters } = await pbes2Kw(alg, key, cek, p2c, p2s));\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            cek = providedCek || generateCek(enc);\n            encryptedKey = await aesKw(alg, key, cek);\n            break;\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            cek = providedCek || generateCek(enc);\n            const { iv } = providedParameters;\n            ({ encryptedKey, ...parameters } = await aesGcmKw(alg, key, cek, iv));\n            break;\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n    return { cek, encryptedKey, parameters };\n}\nexport default encryptKeyManagement;\n","import invalidKeyInput from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nconst symmetricTypeCheck = (key) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${types.join(' or ')} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (key, usage) => {\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${types.join(' or ')} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nconst checkKeyType = (alg, key, usage) => {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(key);\n    }\n    else {\n        asymmetricTypeCheck(key, usage);\n    }\n};\nexport default checkKeyType;\n","import { encoder, concat, uint32be, lengthAndInput, concatKdf } from '../lib/buffer_utils.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport digest from './digest.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport const deriveKey = async (publicKey, privateKey, algorithm, keyLength, apu = new Uint8Array(0), apv = new Uint8Array(0)) => {\n    if (!isCryptoKey(publicKey)) {\n        throw new TypeError(invalidKeyInput(publicKey, ...types));\n    }\n    checkEncCryptoKey(publicKey, 'ECDH-ES');\n    if (!isCryptoKey(privateKey)) {\n        throw new TypeError(invalidKeyInput(privateKey, ...types));\n    }\n    checkEncCryptoKey(privateKey, 'ECDH-ES', 'deriveBits', 'deriveKey');\n    const value = concat(lengthAndInput(encoder.encode(algorithm)), lengthAndInput(apu), lengthAndInput(apv), uint32be(keyLength));\n    if (!privateKey.usages.includes('deriveBits')) {\n        throw new TypeError('ECDH-ES private key \"usages\" must include \"deriveBits\"');\n    }\n    const sharedSecret = new Uint8Array(await crypto.subtle.deriveBits({\n        name: 'ECDH',\n        public: publicKey,\n    }, privateKey, Math.ceil(parseInt(privateKey.algorithm.namedCurve.substr(-3), 10) / 8) <<\n        3));\n    return concatKdf(digest, sharedSecret, keyLength, value);\n};\nexport const generateEpk = async (key) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return (await crypto.subtle.generateKey({ name: 'ECDH', namedCurve: key.algorithm.namedCurve }, true, ['deriveBits'])).privateKey;\n};\nexport const ecdhAllowed = (key) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return ['P-256', 'P-384', 'P-521'].includes(key.algorithm.namedCurve);\n};\n","import { toSPKI as exportPublic } from '../runtime/asn1.js';\nimport { toPKCS8 as exportPrivate } from '../runtime/asn1.js';\nimport keyToJWK from '../runtime/key_to_jwk.js';\nexport async function exportSPKI(key) {\n    return exportPublic(key);\n}\nexport async function exportPKCS8(key) {\n    return exportPrivate(key);\n}\nexport async function exportJWK(key) {\n    return keyToJWK(key);\n}\n","import crypto, { isCryptoKey } from './webcrypto.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { encode as base64url } from './base64url.js';\nimport { types } from './is_key_like.js';\nconst keyToJWK = async (key) => {\n    if (key instanceof Uint8Array) {\n        return {\n            kty: 'oct',\n            k: base64url(key),\n        };\n    }\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (!key.extractable) {\n        throw new TypeError('non-extractable CryptoKey cannot be exported as a JWK');\n    }\n    const { ext, key_ops, alg, use, ...jwk } = await crypto.subtle.exportKey('jwk', key);\n    return jwk;\n};\nexport default keyToJWK;\n","import subtleAlgorithm from './subtle_rsaes.js';\nimport bogusWebCrypto from './bogus.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport checkKeyLength from './check_key_length.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport const encrypt = async (alg, key, cek) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    checkEncCryptoKey(key, alg, 'encrypt', 'wrapKey');\n    checkKeyLength(alg, key);\n    if (key.usages.includes('encrypt')) {\n        return new Uint8Array(await crypto.subtle.encrypt(subtleAlgorithm(alg), key, cek));\n    }\n    if (key.usages.includes('wrapKey')) {\n        const cryptoKeyCek = await crypto.subtle.importKey('raw', cek, ...bogusWebCrypto);\n        return new Uint8Array(await crypto.subtle.wrapKey('raw', cryptoKeyCek, key, subtleAlgorithm(alg)));\n    }\n    throw new TypeError('RSA-OAEP key \"usages\" must include \"encrypt\" or \"wrapKey\" for this operation');\n};\nexport const decrypt = async (alg, key, encryptedKey) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    checkEncCryptoKey(key, alg, 'decrypt', 'unwrapKey');\n    checkKeyLength(alg, key);\n    if (key.usages.includes('decrypt')) {\n        return new Uint8Array(await crypto.subtle.decrypt(subtleAlgorithm(alg), key, encryptedKey));\n    }\n    if (key.usages.includes('unwrapKey')) {\n        const cryptoKeyCek = await crypto.subtle.unwrapKey('raw', encryptedKey, key, subtleAlgorithm(alg), ...bogusWebCrypto);\n        return new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKeyCek));\n    }\n    throw new TypeError('RSA-OAEP key \"usages\" must include \"decrypt\" or \"unwrapKey\" for this operation');\n};\n","export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n","import random from './random.js';\nimport { p2s as concatSalt } from '../lib/buffer_utils.js';\nimport { encode as base64url } from './base64url.js';\nimport { wrap, unwrap } from './aeskw.js';\nimport checkP2s from '../lib/check_p2s.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nfunction getCryptoKey(key, alg) {\n    if (key instanceof Uint8Array) {\n        return crypto.subtle.importKey('raw', key, 'PBKDF2', false, ['deriveBits']);\n    }\n    if (isCryptoKey(key)) {\n        checkEncCryptoKey(key, alg, 'deriveBits', 'deriveKey');\n        return key;\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n}\nasync function deriveKey(p2s, alg, p2c, key) {\n    checkP2s(p2s);\n    const salt = concatSalt(alg, p2s);\n    const keylen = parseInt(alg.substr(13, 3), 10);\n    const subtleAlg = {\n        hash: `SHA-${alg.substr(8, 3)}`,\n        iterations: p2c,\n        name: 'PBKDF2',\n        salt,\n    };\n    const wrapAlg = {\n        length: keylen,\n        name: 'AES-KW',\n    };\n    const cryptoKey = await getCryptoKey(key, alg);\n    if (cryptoKey.usages.includes('deriveBits')) {\n        return new Uint8Array(await crypto.subtle.deriveBits(subtleAlg, cryptoKey, keylen));\n    }\n    if (cryptoKey.usages.includes('deriveKey')) {\n        return crypto.subtle.deriveKey(subtleAlg, cryptoKey, wrapAlg, false, ['wrapKey', 'unwrapKey']);\n    }\n    throw new TypeError('PBKDF2 key \"usages\" must include \"deriveBits\" or \"deriveKey\"');\n}\nexport const encrypt = async (alg, key, cek, p2c = Math.floor(Math.random() * 2049) + 2048, p2s = random(new Uint8Array(16))) => {\n    const derived = await deriveKey(p2s, alg, p2c, key);\n    const encryptedKey = await wrap(alg.substr(-6), derived, cek);\n    return { encryptedKey, p2c, p2s: base64url(p2s) };\n};\nexport const decrypt = async (alg, key, encryptedKey, p2c, p2s) => {\n    const derived = await deriveKey(p2s, alg, p2c, key);\n    return unwrap(alg.substr(-6), derived, encryptedKey);\n};\n","import { JWEInvalid } from '../util/errors.js';\nexport default function checkP2s(p2s) {\n    if (!(p2s instanceof Uint8Array) || p2s.length < 8) {\n        throw new JWEInvalid('PBES2 Salt Input must be 8 or more octets');\n    }\n}\n","import encrypt from '../runtime/encrypt.js';\nimport decrypt from '../runtime/decrypt.js';\nimport generateIv from './iv.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nexport async function wrap(alg, key, cek, iv) {\n    const jweAlgorithm = alg.substr(0, 7);\n    iv || (iv = generateIv(jweAlgorithm));\n    const { ciphertext: encryptedKey, tag } = await encrypt(jweAlgorithm, cek, key, iv, new Uint8Array(0));\n    return { encryptedKey, iv: base64url(iv), tag: base64url(tag) };\n}\nexport async function unwrap(alg, key, encryptedKey, iv, tag) {\n    const jweAlgorithm = alg.substr(0, 7);\n    return decrypt(jweAlgorithm, key, encryptedKey, iv, tag, new Uint8Array(0));\n}\n","import { encode as base64url } from '../../runtime/base64url.js';\nimport encrypt from '../../runtime/encrypt.js';\nimport { deflate } from '../../runtime/zlib.js';\nimport generateIv from '../../lib/iv.js';\nimport encryptKeyManagement from '../../lib/encrypt_key_management.js';\nimport { JOSENotSupported, JWEInvalid } from '../../util/errors.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport validateCrit from '../../lib/validate_crit.js';\nexport const unprotected = Symbol();\nexport class FlattenedEncrypt {\n    constructor(plaintext) {\n        if (!(plaintext instanceof Uint8Array)) {\n            throw new TypeError('plaintext must be an instance of Uint8Array');\n        }\n        this._plaintext = plaintext;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setSharedUnprotectedHeader(sharedUnprotectedHeader) {\n        if (this._sharedUnprotectedHeader) {\n            throw new TypeError('setSharedUnprotectedHeader can only be called once');\n        }\n        this._sharedUnprotectedHeader = sharedUnprotectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    setAdditionalAuthenticatedData(aad) {\n        this._aad = aad;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    async encrypt(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader && !this._sharedUnprotectedHeader) {\n            throw new JWEInvalid('either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()');\n        }\n        if (!isDisjoint(this._protectedHeader, this._unprotectedHeader, this._sharedUnprotectedHeader)) {\n            throw new JWEInvalid('JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n            ...this._sharedUnprotectedHeader,\n        };\n        validateCrit(JWEInvalid, new Map(), options === null || options === void 0 ? void 0 : options.crit, this._protectedHeader, joseHeader);\n        if (joseHeader.zip !== undefined) {\n            if (!this._protectedHeader || !this._protectedHeader.zip) {\n                throw new JWEInvalid('JWE \"zip\" (Compression Algorithm) Header MUST be integrity protected');\n            }\n            if (joseHeader.zip !== 'DEF') {\n                throw new JOSENotSupported('Unsupported JWE \"zip\" (Compression Algorithm) Header Parameter value');\n            }\n        }\n        const { alg, enc } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWEInvalid('JWE \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        if (typeof enc !== 'string' || !enc) {\n            throw new JWEInvalid('JWE \"enc\" (Encryption Algorithm) Header Parameter missing or invalid');\n        }\n        let encryptedKey;\n        if (alg === 'dir') {\n            if (this._cek) {\n                throw new TypeError('setContentEncryptionKey cannot be called when using Direct Encryption');\n            }\n        }\n        else if (alg === 'ECDH-ES') {\n            if (this._cek) {\n                throw new TypeError('setContentEncryptionKey cannot be called when using Direct Key Agreement');\n            }\n        }\n        let cek;\n        {\n            let parameters;\n            ({ cek, encryptedKey, parameters } = await encryptKeyManagement(alg, enc, key, this._cek, this._keyManagementParameters));\n            if (parameters) {\n                if (options && unprotected in options) {\n                    if (!this._unprotectedHeader) {\n                        this.setUnprotectedHeader(parameters);\n                    }\n                    else {\n                        this._unprotectedHeader = { ...this._unprotectedHeader, ...parameters };\n                    }\n                }\n                else {\n                    if (!this._protectedHeader) {\n                        this.setProtectedHeader(parameters);\n                    }\n                    else {\n                        this._protectedHeader = { ...this._protectedHeader, ...parameters };\n                    }\n                }\n            }\n        }\n        this._iv || (this._iv = generateIv(enc));\n        let additionalData;\n        let protectedHeader;\n        let aadMember;\n        if (this._protectedHeader) {\n            protectedHeader = encoder.encode(base64url(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = encoder.encode('');\n        }\n        if (this._aad) {\n            aadMember = base64url(this._aad);\n            additionalData = concat(protectedHeader, encoder.encode('.'), encoder.encode(aadMember));\n        }\n        else {\n            additionalData = protectedHeader;\n        }\n        let ciphertext;\n        let tag;\n        if (joseHeader.zip === 'DEF') {\n            const deflated = await ((options === null || options === void 0 ? void 0 : options.deflateRaw) || deflate)(this._plaintext);\n            ({ ciphertext, tag } = await encrypt(enc, deflated, cek, this._iv, additionalData));\n        }\n        else {\n            ;\n            ({ ciphertext, tag } = await encrypt(enc, this._plaintext, cek, this._iv, additionalData));\n        }\n        const jwe = {\n            ciphertext: base64url(ciphertext),\n            iv: base64url(this._iv),\n            tag: base64url(tag),\n        };\n        if (encryptedKey) {\n            jwe.encrypted_key = base64url(encryptedKey);\n        }\n        if (aadMember) {\n            jwe.aad = aadMember;\n        }\n        if (this._protectedHeader) {\n            jwe.protected = decoder.decode(protectedHeader);\n        }\n        if (this._sharedUnprotectedHeader) {\n            jwe.unprotected = this._sharedUnprotectedHeader;\n        }\n        if (this._unprotectedHeader) {\n            jwe.header = this._unprotectedHeader;\n        }\n        return jwe;\n    }\n}\n","const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n","import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        else if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n","import { FlattenedEncrypt } from '../flattened/encrypt.js';\nexport class CompactEncrypt {\n    constructor(plaintext) {\n        this._flattened = new FlattenedEncrypt(plaintext);\n    }\n    setContentEncryptionKey(cek) {\n        this._flattened.setContentEncryptionKey(cek);\n        return this;\n    }\n    setInitializationVector(iv) {\n        this._flattened.setInitializationVector(iv);\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        this._flattened.setKeyManagementParameters(parameters);\n        return this;\n    }\n    async encrypt(key, options) {\n        const jwe = await this._flattened.encrypt(key, options);\n        return [jwe.protected, jwe.encrypted_key, jwe.iv, jwe.ciphertext, jwe.tag].join('.');\n    }\n}\n","import { importJWK, CompactEncrypt } from \"jose\";\nimport { JweCid, SyfrJwk } from \"./types\";\n\n/**\n * Parse the JWK to a CryptoKey and store both in the keychain\n * @see https://github.com/panva/jose/blob/main/docs/functions/key_import.importJWK.md#readme\n */\nexport async function keyFromJwk(jwk: SyfrJwk) {\n  let key = (await importJWK(jwk, jwk.alg)) as CryptoKey;\n  return key;\n}\n\n/**\n * Returns a compactJwe string\n * @see https://www.rfc-editor.org/rfc/rfc7516.html#section-4.1.12\n * @see https://github.com/panva/jose/blob/main/docs/classes/jwe_compact_encrypt.CompactEncrypt.md#readme\n */\nexport async function makeCompactJwe(\n  jwk: SyfrJwk,\n  key: CryptoKey,\n  cty: string,\n  byteArr: Uint8Array,\n  cids?: JweCid[]\n) {\n  let protectedHeader = {\n    alg: jwk.alg,\n    enc: \"A256GCM\",\n    kid: jwk.kid,\n    cty,\n    cids,\n  };\n  cids ?? delete protectedHeader.cids;\n  let jwe = await new CompactEncrypt(byteArr)\n    .setProtectedHeader(protectedHeader)\n    .encrypt(key);\n  return jwe;\n}\n","import {\n  SyfrDebugEvent,\n  SyfrValidEvent,\n  SyfrRequestEvent,\n  SyfrTransmitEvent,\n} from \"./types\";\n\n/**\n * Each static function creates a CustomEvent and immediately dispatches\n * These should be called by SyfrForm according to the timing indicated\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#events\n * @see SyfrForm\n *\n * @example\n * window.addEventListener(\"DOMContentLoaded\", (event) => {\n *\n * // automatically attempt to use Syfr for all forms on the page\n * Array.from(document.forms).forEach((form) => {\n *\n *   // output debug events so you can see what is happening on the form\n *   form.addEventListener(\"debug\", (event) => {\n *     console.log(\"debugEvent\", event.detail);\n *   });\n *\n *   // output the data being sent to Syfr\n *   form.addEventListener(\"protect\", (event) => {\n *     console.log(\"protectEvent\", event.detail);\n *     // or perhaps activate a lock icon on the form that shows the encryption seal\n *   });\n *\n *   // get the XMLHttpRequest to monitor those events on this form\n *   form.addEventListener(\"request\", (event) => {\n *     for (var key in event.detail) {\n *\n *       // output ALL events emitted from XMLHttpRequest for this form\n *       if (key.search(\"on\") === 0) {\n *         event.detail.addEventListener(key.slice(2), (event) => {\n *           console.log(\"XHR Event\", event);\n *           // or perhaps show the % uploaded in a progress bar\n *           // or perhaps change submit button to a spinner from `loadstart` until `loadend`\n *         });\n *       }\n *     }\n *   });\n *\n *   // output the data being sent to Syfr\n *   form.addEventListener(\"transmit\", (event) => {\n *     console.log(\"transmitEvent\", event.detail);\n *     // generaully this should not be used\n *   });\n * });\n * });\n *\n * @note to set custom validation constraints:\n * @example\n * let myForm = document.getElementById(\"myForm\") // to manage a specific form\n * let lastName = document.getElementById(\"last-name\");\n * if(lastName.value instanceOf number){\n *   lastName.setCustomValidity(\"Cannot be a number\");\n *   myForm.querySelector('[type=\"submit\"]').toggleAttribute(\"disabled\");\n * }\n *\n * @note perhaps disable submit by default and enable when form is in a valid state\n * @see https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Constraint_validation\n */\nexport class SyfrEvent {\n  static debug(form: HTMLFormElement, detail: SyfrDebugEvent[\"detail\"]) {\n    form.dispatchEvent(new CustomEvent(\"debug\", { detail }) as SyfrDebugEvent);\n  }\n\n  static valid(form: HTMLFormElement, detail?: SyfrValidEvent[\"detail\"]) {\n    form.dispatchEvent(new CustomEvent(\"valid\", { detail }) as SyfrValidEvent);\n  }\n\n  static transmit(form: HTMLFormElement, detail: SyfrTransmitEvent[\"detail\"]) {\n    form.dispatchEvent(\n      new CustomEvent(\"transmit\", { detail }) as SyfrTransmitEvent\n    );\n  }\n\n  static request(form: HTMLFormElement, detail: SyfrRequestEvent[\"detail\"]) {\n    form.dispatchEvent(\n      new CustomEvent(\"request\", { detail }) as SyfrRequestEvent\n    );\n  }\n}\n","import { keyFromJwk, makeCompactJwe } from \"./encrypt\";\nimport { SyfrEvent } from \"./event\";\nimport { fetchFromApi, pushToApi } from \"./request\";\nimport {\n  CompactJwe,\n  FileJweMeta,\n  JweCid,\n  JweMap,\n  SyfrFormId,\n  SyfrJweContent,\n} from \"./types\";\n\n/**\n * Automatically initialized when script is included.\n * Use event listeners to enhance user experience\n * @see SyfrEvent\n */\nexport class SyfrClass {\n  id: SyfrFormId; // the UUID of the form in Syfr\n  form: HTMLFormElement; // the DOM representation of the form\n  response?: Awaited<ReturnType<typeof fetchFromApi>> & {\n    publicKey: CryptoKey; // the CryptoKey from the JWK to encrypt the formdata\n  }; // the object response from Syfr Api\n  jwes: JweMap = {}; // the JWEs which will be submitted to Syfr\n  loading: boolean = false;\n  link?: HTMLAnchorElement;\n\n  constructor(\n    form: SyfrClass[\"form\"],\n    syfrId?: SyfrFormId,\n    link?: HTMLAnchorElement\n  ) {\n    this.form = form;\n    let id = syfrId ?? form.dataset?.syfrId;\n    if (!id) {\n      throw {\n        form: this.form,\n        error: `Ignoring: no form id`,\n      };\n    }\n    this.id = id;\n    this.link =\n      link ?? this.form.querySelector(\"[data-syfr-validate]\") ?? undefined;\n    this.autoSubmit();\n  }\n\n  linkCheck() {\n    let linkEl = this.link;\n    if (!linkEl)\n      throw {\n        form: this.form,\n        error: `The form must have a validation link, ex: <a data-syfr-validate ...`,\n        seeDocs: \"https://syfr.app/docs/validation\",\n      };\n    let href = `https://syfr.app/validate/${this.id}`;\n    let issues = {\n      ...(!(linkEl instanceof HTMLAnchorElement) && {\n        linkHref: { got: linkEl, want: `<a href='${href}' ...` },\n      }),\n      ...(!this.form.contains(linkEl) && {\n        linkWithinForm: { got: false, want: true },\n      }),\n      ...(!this.id.match(\n        /^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i\n      ) && { syfrId: { got: this.id, want: \"a valid uuid from Syfr\" } }),\n    };\n    if (Object.keys(issues).length < 1 && linkEl instanceof HTMLAnchorElement) {\n      let cs = getComputedStyle(linkEl);\n      let pf = parseFloat;\n      let px = pf(cs.paddingLeft) + pf(cs.paddingRight);\n      let py = pf(cs.paddingTop) + pf(cs.paddingBottom);\n      let bx = pf(cs.borderLeftWidth) + pf(cs.borderRightWidth);\n      let by = pf(cs.borderTopWidth) + pf(cs.borderBottomWidth);\n      let heightPx = linkEl.offsetHeight - px - bx;\n      let widthPx = linkEl.offsetWidth - py - by;\n      let areaPx = heightPx * widthPx;\n      let fontSizePx = pf(cs.fontSize);\n      issues = {\n        ...issues,\n        ...(linkEl.offsetParent === null && {\n          validationLinkIsHidden: { got: true, want: false },\n        }),\n        ...(linkEl.href != href && {\n          validationLinkHref: { got_: linkEl.href, want: href },\n        }),\n        ...(linkEl.relList.contains(\"nofollow\") && {\n          validationLinkIsNofollow: { got: true, want: false },\n        }),\n        ...(linkEl.relList.contains(\"noreferrer\") && {\n          validationLinkIsNoreferrer: { got: true, want: false },\n        }),\n        ...(areaPx < 1536 && {\n          validationLinkArea: { got: areaPx, want: 1536 },\n        }),\n        ...(fontSizePx < 8 && {\n          validationLinkFontSizePx: { got: fontSizePx, want: \"8px+\" },\n        }),\n      };\n    }\n    if (Object.keys(issues).length > 0) {\n      throw {\n        form: this.form,\n        link: linkEl,\n        issues,\n        error: `We can't protect your form because of the issues listed`,\n        seeDocs: \"https://syfr.app/docs/validation\",\n      };\n    }\n    return true;\n  }\n\n  async api() {\n    if (this.response) return this.response;\n    try {\n      let response = await fetchFromApi(this.id);\n      let publicKey = await keyFromJwk(response.publicJwk);\n      if (!response.whiteLabel) {\n        this.linkCheck();\n      }\n      this.response = { ...response, publicKey };\n      SyfrEvent.valid(this.form, {\n        id: this.id,\n        validateUrl: `https://syfr.app/validate/${this.id}`,\n      });\n      SyfrEvent.debug(this.form, {\n        id: this.id,\n        formPubKey: this.response.publicKey,\n        message:\n          \"use addEventListener('protected',(event)=>{...} to notify your users of the protection\",\n      });\n      return this.response;\n    } catch (e) {\n      throw {\n        syfrId: this.id,\n        error: \"Bad data-syfr-id or some other error with API\",\n      };\n    }\n  }\n\n  async getJwk() {\n    return (await this.api()).publicJwk;\n  }\n\n  async getKey() {\n    return (await this.api()).publicKey;\n  }\n\n  /**\n   * Listens for the form submit (the SubmitEvent only fires if it succeeds validation)\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit_event\n   */\n  autoSubmit() {\n    SyfrEvent.debug(this.form, {\n      message: \"Initializing SyfrClass\",\n      syfrId: this.id,\n      form: this.form,\n    });\n    this.api(); // preload response\n    this.form.addEventListener(\"submit\", async (event: SubmitEvent) => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      event.stopPropagation();\n      if (this.loading) {\n        SyfrEvent.debug(this.form, \"Ignored duplicate submission.\");\n        return;\n      }\n      this.loading = true;\n      await this.submit();\n      this.form.reset();\n      this.jwes = {};\n      this.loading = false;\n    });\n  }\n\n  async submit() {\n    await this.api();\n    await this.buildEntry();\n    await this.sendToSyfr();\n  }\n\n  async buildEntry() {\n    let code = this.getCode();\n    let data = await this.getData();\n    await this.buildRootJwe({ code, data });\n  }\n\n  /**\n   * Serialize the form HTML to a string\n   * already considered and rejected https://developer.mozilla.org/en-US/docs/Web/API/DOMParser\n   */\n  getCode() {\n    return new XMLSerializer()\n      .serializeToString(this.form)\n      .replace(/\\s{2,}/g, \" \"); //remove extra spacing\n  }\n\n  async getData() {\n    let srcFormData = new FormData(this.form);\n    let result: SyfrJweContent[\"data\"] = {};\n    for (let fieldName of srcFormData.keys()) {\n      if (fieldName in result) {\n        continue; //skip duplicate key (ex: a field can have multiple files using same key)\n      }\n      let fieldArr = srcFormData.getAll(fieldName);\n      let parsed = await this.getParsedFieldArr(fieldArr);\n      // use srcFormData to determine if output should be an array\n      result[fieldName] = fieldArr.length > 1 ? parsed : parsed[0];\n    }\n    return result;\n  }\n\n  async buildRootJwe(stringifiableObj: object) {\n    const pubJwk = await this.getJwk();\n    const pubKey = await this.getKey();\n    const byteArr = new TextEncoder().encode(JSON.stringify(stringifiableObj));\n    const rootJwe = await makeCompactJwe(\n      pubJwk,\n      pubKey,\n      \"application/json\",\n      byteArr,\n      Object.keys(this.jwes)\n    );\n    this.jwes[this.jweToCid(rootJwe)] = rootJwe;\n  }\n\n  async getParsedFieldArr(fieldArr: FormDataEntryValue[]) {\n    let response = [];\n    for (let field of fieldArr) {\n      response.push(await this.getParsedField(field));\n    }\n    return response;\n  }\n\n  async getParsedField(field: FormDataEntryValue) {\n    return field instanceof File ? await this.processFile(field) : field;\n  }\n\n  async processFile(file: File) {\n    const pubJwk = await this.getJwk();\n    const pubKey = await this.getKey();\n    if (file.size > 0) {\n      let fileJwe = await makeCompactJwe(\n        pubJwk,\n        pubKey,\n        file.type,\n        await this.fileToUint8(file)\n      );\n      this.jwes[this.jweToCid(fileJwe)] = fileJwe;\n      return this.fileToMeta(file, fileJwe);\n    }\n  }\n\n  async fileToUint8(file: File) {\n    let buf = await file.arrayBuffer();\n    return new Uint8Array(buf);\n  }\n\n  /**\n   * Drops file streams (no .t`ex`t(), no .arrayBuffer(), .etc)\n   */\n  fileToMeta(file: File, jwe: CompactJwe) {\n    let { name, lastModified, type } = file;\n    let fileJweMeta: FileJweMeta = {\n      name,\n      lastModified,\n      type,\n      cids: [this.jweToCid(jwe)], // plural for future chunking.\n    };\n    return fileJweMeta;\n  }\n\n  jweToCid(jwe: CompactJwe): JweCid {\n    let response = jwe.split(\".\")[4];\n    if (!response) throw \"Provided JWE was invalid\";\n    return response;\n  }\n\n  async sendToSyfr() {\n    let payload = new FormData();\n    Object.values(this.jwes).forEach((jwe) => {\n      payload.append(\"compactJwe\", jwe);\n    });\n    SyfrEvent.transmit(this.form, { jwes: this.jwes, payload });\n    SyfrEvent.debug(this.form, {\n      message: \"Sending to Syfr:\",\n      jwes: this.jwes,\n      payload,\n    });\n    await pushToApi(payload, this.form);\n  }\n}\n","import { SyfrJwk } from \"./types\";\n\n/**\n * @see https://github.com/syfrapp/api/issues/101\n */\nexport async function fetchFromApi(id: string) {\n  let response = await fetch(\n    \"https://develop-api.syfr.app/rest/pub/form/\" + id,\n    { method: \"GET\" }\n  );\n  return (await response.json()) as { publicJwk: SyfrJwk; whiteLabel: boolean };\n}\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n * @see https://github.com/syfrapp/api/issues/103\n */\nexport async function pushToApi(payload: FormData, form: HTMLFormElement) {\n  let request = new XMLHttpRequest();\n  form.dispatchEvent(new CustomEvent(\"request\", { detail: request }));\n  request.open(\"POST\", \"https://develop-api.syfr.app/rest/pub/entry\");\n  request.send(payload);\n}\n","import { decode as decodeBase64URL, encodeBase64, decodeBase64 } from '../runtime/base64url.js';\nimport { fromSPKI as importPublic } from '../runtime/asn1.js';\nimport { fromPKCS8 as importPrivate } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport formatPEM from '../lib/format_pem.js';\nimport isObject from '../lib/is_object.js';\nfunction getElement(seq) {\n    let result = [];\n    let next = 0;\n    while (next < seq.length) {\n        let nextPart = parseElement(seq.subarray(next));\n        result.push(nextPart);\n        next += nextPart.byteLength;\n    }\n    return result;\n}\nfunction parseElement(bytes) {\n    let position = 0;\n    let tag = bytes[0] & 0x1f;\n    position++;\n    if (tag === 0x1f) {\n        tag = 0;\n        while (bytes[position] >= 0x80) {\n            tag = tag * 128 + bytes[position] - 0x80;\n            position++;\n        }\n        tag = tag * 128 + bytes[position] - 0x80;\n        position++;\n    }\n    let length = 0;\n    if (bytes[position] < 0x80) {\n        length = bytes[position];\n        position++;\n    }\n    else {\n        let numberOfDigits = bytes[position] & 0x7f;\n        position++;\n        length = 0;\n        for (let i = 0; i < numberOfDigits; i++) {\n            length = length * 256 + bytes[position];\n            position++;\n        }\n    }\n    if (length === 0x80) {\n        length = 0;\n        while (bytes[position + length] !== 0 || bytes[position + length + 1] !== 0) {\n            length++;\n        }\n        const byteLength = position + length + 2;\n        return {\n            byteLength,\n            contents: bytes.subarray(position, position + length),\n            raw: bytes.subarray(0, byteLength),\n        };\n    }\n    const byteLength = position + length;\n    return {\n        byteLength,\n        contents: bytes.subarray(position, byteLength),\n        raw: bytes.subarray(0, byteLength),\n    };\n}\nfunction spkiFromX509(buf) {\n    const tbsCertificate = getElement(getElement(parseElement(buf).contents)[0].contents);\n    return encodeBase64(tbsCertificate[tbsCertificate[0].raw[0] === 0xa0 ? 6 : 5].raw);\n}\nfunction getSPKI(x509) {\n    const pem = x509.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\\s)/g, '');\n    const raw = decodeBase64(pem);\n    return formatPEM(spkiFromX509(raw), 'PUBLIC KEY');\n}\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return importPublic(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    const spki = getSPKI(x509);\n    return importPublic(spki, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PCKS8 formatted string');\n    }\n    return importPrivate(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg, octAsKeyObject) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    if (typeof alg !== 'string' || !alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            octAsKeyObject !== null && octAsKeyObject !== void 0 ? octAsKeyObject : (octAsKeyObject = jwk.ext !== true);\n            if (octAsKeyObject) {\n                return asKeyObject({ ...jwk, alg, ext: false });\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if (jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n","function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","TextEncoder","TextDecoder","MAX_INT32","buffers","size","reduce","acc","length","buf","Uint8Array","i","forEach","buffer","set","writeUInt32BE","offset","RangeError","uint32be","lengthAndInput","input","encode","unencoded","arr","push","String","fromCharCode","apply","subarray","btoa","join","replace","decode","encoded","atob","split","map","c","charCodeAt","_a","TypeError","Error","constructor","message","super","this","code","name","captureStackTrace","arguments","extractable","algorithm","type","bitLength","alg","cek","expected","deflate","async","hash","unusable","isAlgorithm","usages","parseInt","substr","some","includes","msg","last","pop","checkUsage","actual","types","wrap","cryptoKey","usage","getCryptoKey","checkKeySize","cryptoKeyCek","bogus","data","subtleDigest","subtleRsaEs","undefined","process","versions","node","jwk","_b","keyUsages","kty","d","namedCurve","crv","WebSocketPair","subtleMapping","rest","ext","key_ops","k","keyData","enc","plaintext","iv","aad","keySize","encKey","macKey","ciphertext","macData","high","Math","floor","low","tag","slice","cbcEncrypt","encrypted","additionalData","tagLength","gcmEncrypt","providedCek","providedParameters","encryptedKey","parameters","startsWith","test","symmetricTypeCheck","asymmetricTypeCheck","apu","apv","epk","ephemeralKey","privateKey","x","y","use","exportJWK","sharedSecret","publicKey","keyLength","public","ceil","digest","secret","bits","iterations","res","iter","concatKdf","kwAlg","modulusLength","p2c","p2s","random","derived","checkP2s","salt","p2sInput","keylen","subtleAlg","wrapAlg","jweAlgorithm","_plaintext","setKeyManagementParameters","_keyManagementParameters","setProtectedHeader","protectedHeader","_protectedHeader","setSharedUnprotectedHeader","sharedUnprotectedHeader","_sharedUnprotectedHeader","setUnprotectedHeader","unprotectedHeader","_unprotectedHeader","setAdditionalAuthenticatedData","_aad","setContentEncryptionKey","_cek","setInitializationVector","_iv","options","headers","sources","filter","Boolean","header","keys","parameter","has","add","Set","joseHeader","Err","recognizedDefault","recognizedOption","crit","Array","isArray","recognized","Map","entries","zip","aadMember","JSON","stringify","deflated","deflateRaw","jwe","encrypted_key","protected","unprotected","_flattened","encrypt","makeCompactJwe","cty","byteArr","cids","kid","SyfrEvent","static","form","detail","dispatchEvent","CustomEvent","SyfrClass","syfrId","link","jwes","loading","id","dataset","error","querySelector","autoSubmit","linkCheck","linkEl","seeDocs","href","issues","HTMLAnchorElement","linkHref","got","want","contains","linkWithinForm","match","cs","getComputedStyle","pf","parseFloat","px","paddingLeft","paddingRight","py","paddingTop","paddingBottom","bx","borderLeftWidth","borderRightWidth","by","borderTopWidth","borderBottomWidth","areaPx","offsetHeight","offsetWidth","fontSizePx","fontSize","offsetParent","validationLinkIsHidden","validationLinkHref","got_","relList","validationLinkIsNofollow","validationLinkIsNoreferrer","validationLinkArea","validationLinkFontSizePx","response","fetch","method","json","fetchFromApi","octAsKeyObject","toString","getPrototypeOf","proto","oth","keyFromJwk","publicJwk","whiteLabel","valid","validateUrl","debug","formPubKey","e","api","addEventListener","event","preventDefault","stopImmediatePropagation","stopPropagation","submit","reset","buildEntry","sendToSyfr","getCode","getData","buildRootJwe","XMLSerializer","serializeToString","srcFormData","FormData","result","fieldName","fieldArr","getAll","parsed","getParsedFieldArr","stringifiableObj","pubJwk","getJwk","pubKey","getKey","rootJwe","jweToCid","field","getParsedField","File","processFile","file","fileJwe","fileToUint8","fileToMeta","arrayBuffer","lastModified","payload","values","append","transmit","request","XMLHttpRequest","open","send","pushToApi"],"sourceRoot":""}